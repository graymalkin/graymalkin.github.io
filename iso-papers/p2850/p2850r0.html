<!doctype html><html lang="en">
 <head>
  <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
  <meta content="width=device-width, initial-scale=1, shrink-to-fit=no" name="viewport">
  <title>P2850R0: Minimal Compiler Preserved Dependencies</title>
<style data-fill-with="stylesheet">/******************************************************************************
 *                   Style sheet for the W3C specifications                   *
 *
 * Special classes handled by this style sheet include:
 *
 * Indices
 *   - .toc for the Table of Contents (<ol class="toc">)
 *     + <span class="secno"> for the section numbers
 *   - #toc for the Table of Contents (<nav id="toc">)
 *   - ul.index for Indices (<a href="#ref">term</a><span>, in § N.M</span>)
 *   - table.index for Index Tables (e.g. for properties or elements)
 *
 * Structural Markup
 *   - table.data for general data tables
 *     -> use 'scope' attribute, <colgroup>, <thead>, and <tbody> for best results !
 *     -> use <table class='complex data'> for extra-complex tables
 *     -> use <td class='long'> for paragraph-length cell content
 *     -> use <td class='pre'> when manual line breaks/indentation would help readability
 *   - dl.switch for switch statements
 *   - ol.algorithm for algorithms (helps to visualize nesting)
 *   - .figure and .caption (HTML4) and figure and figcaption (HTML5)
 *     -> .sidefigure for right-floated figures
 *   - ins/del
 *     -> ins/del.c### for candidate and proposed changes (amendments)
 *
 * Code
 *   - pre and code
 *
 * Special Sections
 *   - .note       for informative notes             (div, p, span, aside, details)
 *   - .example    for informative examples          (div, p, pre, span)
 *   - .issue      for issues                        (div, p, span)
 *   - .advisement for loud normative statements     (div, p, strong)
 *   - .annoying-warning for spec obsoletion notices (div, aside, details)
 *   - .correction for "candidate corrections"       (div, aside, details, section)
 *   - .addition   for "candidate additions"         (div, aside, details, section)
 *   - .correction.proposed for "proposed corrections" (div, aside, details, section)
 *   - .addition.proposed   for "proposed additions"   (div, aside, details, section)
 *
 * Definition Boxes
 *   - pre.def   for WebIDL definitions
 *   - table.def for tables that define other entities (e.g. CSS properties)
 *   - dl.def    for definition lists that define other entitles (e.g. HTML elements)
 *
 * Numbering
 *   - .secno for section numbers in .toc and headings (<span class='secno'>3.2</span>)
 *   - .marker for source-inserted example/figure/issue numbers (<span class='marker'>Issue 4</span>)
 *   - ::before styled for CSS-generated issue/example/figure numbers:
 *     -> Documents wishing to use this only need to add
 *        figcaption::before,
 *        .caption::before { content: "Figure "  counter(figure) " ";  }
 *        .example::before { content: "Example " counter(example) " "; }
 *        .issue::before   { content: "Issue "   counter(issue) " ";   }
 *
 * Header Stuff (ignore, just don't conflict with these classes)
 *   - .head for the header
 *   - .copyright for the copyright
 *
 * Outdated warning for old specs
 *
 * Miscellaneous
 *   - .overlarge for things that should be as wide as possible, even if
 *     that overflows the body text area. This can be used on an item or
 *     on its container, depending on the effect desired.
 *     Note that this styling basically doesn't help at all when printing,
 *     since A4 paper isn't much wider than the max-width here.
 *     It's better to design things to fit into a narrower measure if possible.
 *
 *   - js-added ToC jump links (see fixup.js)
 *
 ******************************************************************************/

/* color variables included separately for reliability */

/******************************************************************************/
/*                                    Body                                    */
/******************************************************************************/

	html {
	}

	body {
		counter-reset: example figure issue;

		/* Layout */
		max-width: 50em;			  /* limit line length to 50em for readability   */
		margin: 0 auto;				/* center text within page                    */
		padding: 1.6em 1.5em 2em 50px; /* assume 16px font size for downlevel clients */
		padding: 1.6em 1.5em 2em calc(26px + 1.5em); /* leave space for status flag    */

		/* Typography */
		line-height: 1.5;
		font-family: sans-serif;
		widows: 2;
		orphans: 2;
		word-wrap: break-word;
		overflow-wrap: break-word;
		hyphens: auto;

		color: black;
		color: var(--text);
		background: white top left fixed no-repeat;
		background: var(--bg) top left fixed no-repeat;
		background-size: 25px auto;
	}


/******************************************************************************/
/*                         Front Matter & Navigation                          */
/******************************************************************************/

/** Header ********************************************************************/

	div.head { margin-bottom: 1em; }
	div.head hr { border-style: solid; }

	div.head h1 {
		font-weight: bold;
		margin: 0 0 .1em;
		font-size: 220%;
	}

	div.head h2 { margin-bottom: 1.5em;}

/** W3C Logo ******************************************************************/

	.head .logo {
		float: right;
		margin: 0.4rem 0 0.2rem .4rem;
	}

	.head img[src*="logos/W3C"] {
		display: block;
		border: solid #1a5e9a;
		border: solid var(--logo-bg);
		border-width: .65rem .7rem .6rem;
		border-radius: .4rem;
		background: #1a5e9a;
		background: var(--logo-bg);
		color: white;
		color: var(--logo-text);
		font-weight: bold;
	}

	.head a:hover > img[src*="logos/W3C"],
	.head a:focus > img[src*="logos/W3C"] {
		opacity: .8;
	}

	.head a:active > img[src*="logos/W3C"] {
		background: #c00;
		background: var(--logo-active-bg);
		border-color: #c00;
		border-color: var(--logo-active-bg);
	}

	/* see also additional rules in Link Styling section */

/** Copyright *****************************************************************/

	p.copyright,
	p.copyright small { font-size: small; }

/** Back to Top / ToC Toggle **************************************************/

	@media print {
		#toc-nav {
			display: none;
		}
	}
	@media not print {
		#toc-nav {
			position: fixed;
			z-index: 3;
			bottom: 0; left: 0;
			margin: 0;
			min-width: 1.33em;
			border-top-right-radius: 2rem;
			box-shadow: 0 0 2px;
			font-size: 1.5em;
		}
		#toc-nav > a {
			display: block;
			white-space: nowrap;

			height: 1.33em;
			padding: .1em 0.3em;
			margin: 0;

			box-shadow: 0 0 2px;
			border: none;
			border-top-right-radius: 1.33em;

			color: #707070;
			color: var(--tocnav-normal-text);
			background: white;
			background: var(--tocnav-normal-bg);
		}
		#toc-nav > a:hover,
		#toc-nav > a:focus {
			color: black;
			color: var(--tocnav-hover-text);
			background: #f8f8f8;
			background: var(--tocnav-hover-bg);
		}
		#toc-nav > a:active {
			color: #c00;
			color: var(--tocnav-active-text);
			background: white;
			background: var(--tocnav-active-bg);
		}

		#toc-nav > #toc-jump {
			padding-bottom: 2em;
			margin-bottom: -1.9em;
		}

		/* statusbar gets in the way on keyboard focus; remove once browsers fix */
		#toc-nav > a[href="#toc"]:not(:hover):focus:last-child {
			padding-bottom: 1.5rem;
		}

		#toc-nav:not(:hover) > a:not(:focus) > span + span {
			/* Ideally this uses :focus-within on #toc-nav */
			display: none;
		}
		#toc-nav > a > span + span {
			padding-right: 0.2em;
		}
	}

/** ToC Sidebar ***************************************************************/

	/* Floating sidebar */
	@media screen {
		body.toc-sidebar #toc {
			position: fixed;
			top: 0; bottom: 0;
			left: 0;
			width: 23.5em;
			max-width: 80%;
			max-width: calc(100% - 2em - 26px);
			overflow: auto;
			padding: 0 1em;
			padding-left: 42px;
			padding-left: calc(1em + 26px);
			color: black;
			color: var(--tocsidebar-text);
			background: inherit;
			background-color: #f7f8f9;
			background-color: var(--tocsidebar-bg);
			z-index: 1;
			box-shadow: -.1em 0 .25em rgba(0,0,0,.1) inset;
			box-shadow: -.1em 0 .25em var(--tocsidebar-shadow) inset;
		}
		body.toc-sidebar #toc h2 {
			margin-top: .8rem;
			font-variant: small-caps;
			font-variant: all-small-caps;
			text-transform: lowercase;
			font-weight: bold;
			color: gray;
			color: hsla(203,20%,40%,.7);
			color: var(--tocsidebar-heading-text);
		}
		body.toc-sidebar #toc-jump:not(:focus) {
			width: 0;
			height: 0;
			padding: 0;
			position: absolute;
			overflow: hidden;
		}
	}
	/* Hide main scroller when only the ToC is visible anyway */
	@media screen and (max-width: 28em) {
		body.toc-sidebar {
			overflow: hidden;
		}
	}

	/* Sidebar with its own space */
	@media screen and (min-width: 78em) {
		body:not(.toc-inline) #toc {
			position: fixed;
			top: 0; bottom: 0;
			left: 0;
			width: 23.5em;
			overflow: auto;
			padding: 0 1em;
			padding-left: 42px;
			padding-left: calc(1em + 26px);
			color: black;
			color: var(--tocsidebar-text);
			background: inherit;
			background-color: #f7f8f9;
			background-color: var(--tocsidebar-bg);
			z-index: 1;
			box-shadow: -.1em 0 .25em rgba(0,0,0,.1) inset;
			box-shadow: -.1em 0 .25em var(--tocsidebar-shadow) inset;
		}
		body:not(.toc-inline) #toc h2 {
			margin-top: .8rem;
			font-variant: small-caps;
			font-variant: all-small-caps;
			text-transform: lowercase;
			font-weight: bold;
			color: gray;
			color: hsla(203,20%,40%,.7);
			color: var(--tocsidebar-heading-text);
		}

		body:not(.toc-inline) {
			padding-left: 29em;
		}
		/* See also Overflow section at the bottom */

		body:not(.toc-inline) #toc-jump:not(:focus) {
			width: 0;
			height: 0;
			padding: 0;
			position: absolute;
			overflow: hidden;
		}
	}
	@media screen and (min-width: 90em) {
		body:not(.toc-inline) {
			margin: 0 4em;
		}
	}

/******************************************************************************/
/*                                Sectioning                                  */
/******************************************************************************/

/** Headings ******************************************************************/

	h1, h2, h3, h4, h5, h6, dt {
		page-break-after: avoid;
		page-break-inside: avoid;
		font: 100% sans-serif;   /* Reset all font styling to clear out UA styles */
		font-family: inherit;	/* Inherit the font family. */
		line-height: 1.2;		/* Keep wrapped headings compact */
		hyphens: manual;		/* Hyphenated headings look weird */
	}

	h2, h3, h4, h5, h6 {
		margin-top: 3rem;
	}

	h1, h2, h3 {
		color: #005A9C;
		color: var(--heading-text);
	}

	h1 { font-size: 170%; }
	h2 { font-size: 140%; }
	h3 { font-size: 120%; }
	h4 { font-weight: bold; }
	h5 { font-style: italic; }
	h6 { font-variant: small-caps; }
	dt { font-weight: bold; }

/** Subheadings ***************************************************************/

	h1 + h2,
	#profile-and-date {
		/* #profile-and-date is a subtitle in an H2 under the H1 */
		margin-top: 0;
	}
	h2 + h3,
	h3 + h4,
	h4 + h5,
	h5 + h6 {
		margin-top: 1.2em; /* = 1 x line-height */
	}

/** Section divider ***********************************************************/

	:not(.head) > :not(.head) + hr {
		font-size: 1.5em;
		text-align: center;
		margin: 1em auto;
		height: auto;
		color: black;
		color: var(--hr-text);
		border: transparent solid 0;
		background: transparent;
	}
	:not(.head) > hr::before {
		content: "\2727\2003\2003\2727\2003\2003\2727";
	}

/******************************************************************************/
/*                            Paragraphs and Lists                            */
/******************************************************************************/

	p {
		margin: 1em 0;
	}

	dd > p:first-child,
	li > p:first-child {
		margin-top: 0;
	}

	ul, ol {
		margin-left: 0;
		padding-left: 2em;
	}

	li {
		margin: 0.25em 0 0.5em;
		padding: 0;
	}

	dl dd {
		margin: 0 0 .5em 2em;
	}

	.head dd + dd { /* compact for header */
		margin-top: -.5em;
	}

	/* Style for algorithms */
	ol.algorithm ol:not(.algorithm),
	.algorithm > ol ol:not(.algorithm) {
	border-left: 0.5em solid #DEF;
	border-left: 0.5em solid var(--algo-border);
	}

	/* Put nice boxes around each algorithm. */
	[data-algorithm]:not(.heading) {
	 padding: .5em;
	 border: thin solid #ddd;
	 border: thin solid var(--algo-border);
	 border-radius: .5em;
	 margin: .5em calc(-0.5em - 1px);
	}
	[data-algorithm]:not(.heading) > :first-child {
	 margin-top: 0;
	}
	[data-algorithm]:not(.heading) > :last-child {
	 margin-bottom: 0;
	}

	/* Style for switch/case <dl>s */
	dl.switch > dd > ol.only,
	dl.switch > dd > .only > ol {
	margin-left: 0;
	}
	dl.switch > dd > ol.algorithm,
	dl.switch > dd > .algorithm > ol {
	margin-left: -2em;
	}
	dl.switch {
	padding-left: 2em;
	}
	dl.switch > dt {
	text-indent: -1.5em;
	margin-top: 1em;
	}
	dl.switch > dt + dt {
	margin-top: 0;
	}
	dl.switch > dt::before {
	content: '\21AA';
	padding: 0 0.5em 0 0;
	display: inline-block;
	width: 1em;
	text-align: right;
	line-height: 0.5em;
	}

/** Terminology Markup ********************************************************/


/******************************************************************************/
/*                                 Inline Markup                              */
/******************************************************************************/

/** Terminology Markup ********************************************************/
	dfn   { /* Defining instance */
		font-weight: bolder;
	}
	a > i { /* Instance of term */
		font-style: normal;
	}
	dt dfn code, code.idl {
		font-size: inherit;
	}
	dfn var {
		font-style: normal;
	}

/** Change Marking ************************************************************/

	del {
		color: #aa0000;
		color: var(--del-text);
		background: transparent;
		background: var(--del-bg);
		text-decoration: line-through;
	}
	ins {
		color: #006100;
		color: var(--ins-text);
		background: transparent;
		background: var(--ins-bg);
		text-decoration: underline;
	}

	/* for amendments (candidate/proposed changes) */

	.amendment ins, .correction ins, .addition ins,
	ins[class^=c] {
		text-decoration-style: dotted;
	}
	.amendment del, .correction del, .addition del,
	del[class^=c] {
		text-decoration-style: dotted;
	}
	.amendment.proposed ins, .correction.proposed ins, .addition.proposed ins,
	ins[class^=c].proposed {
		text-decoration-style: double;
	}
	.amendment.proposed del, .correction.proposed del, .addition.proposed del,
	del[class^=c].proposed {
		text-decoration-style: double;
	}

/** Miscellaneous improvements to inline formatting ***************************/

	sup {
		vertical-align: super;
		font-size: 80%
	}

/******************************************************************************/
/*                                    Code                                    */
/******************************************************************************/

/** General monospace/pre rules ***********************************************/

	pre, code, samp {
		font-family: Menlo, Consolas, "DejaVu Sans Mono", Monaco, monospace;
		font-size: .9em;
		hyphens: none;
		text-transform: none;
		text-align: left;
		text-align: start;
		font-variant: normal;
		orphans: 3;
		widows: 3;
		page-break-before: avoid;
	}
	pre code,
	code code {
		font-size: 100%;
	}

	pre {
		margin-top: 1em;
		margin-bottom: 1em;
		overflow: auto;
	}

/** Inline Code fragments *****************************************************/

	/* Do something nice. */

/******************************************************************************/
/*                                    Links                                   */
/******************************************************************************/

/** General Hyperlinks ********************************************************/

	/* We hyperlink a lot, so make it less intrusive */
	a[href] {
		color: #034575;
		color: var(--a-normal-text);
		text-decoration: underline #707070;
		text-decoration: underline var(--a-normal-underline);
		text-decoration-skip-ink: none;
	}
	a:visited {
		color: #034575;
		color: var(--a-visited-text);
		text-decoration-color: #bbb;
		text-decoration-color: var(--a-visited-underline);
	}

	/* Indicate interaction with the link */
	a[href]:focus,
	a[href]:hover {
		text-decoration-thickness: 2px;
	}
	a[href]:active {
		color: #c00;
		color: var(--a-active-text);
		text-decoration-color: #c00;
		text-decoration-color: var(--a-active-underline);
	}

	/* Backout above styling for W3C logo */
	.head .logo,
	.head .logo a {
		border: none;
		text-decoration: none;
		background: transparent;
	}

/******************************************************************************/
/*                                    Images                                  */
/******************************************************************************/

	img {
		border-style: none;
	}

	img, svg {
		/* Intentionally not color-scheme aware. */
		background: white;
	}

	/* For autogen numbers, add
	  .caption::before, figcaption::before { content: "Figure " counter(figure) ". "; }
	*/

	figure, .figure, .sidefigure {
		page-break-inside: avoid;
		text-align: center;
		margin: 2.5em 0;
	}
	.figure img,	.sidefigure img,	figure img,
	.figure object, .sidefigure object, figure object {
		max-width: 100%;
		margin: auto;
		height: auto;
	}
	.figure pre, .sidefigure pre, figure pre {
		text-align: left;
		display: table;
		margin: 1em auto;
	}
	.figure table, figure table {
		margin: auto;
	}
	@media screen and (min-width: 20em) {
		.sidefigure {
			float: right;
			width: 50%;
			margin: 0 0 0.5em 0.5em;
		}
	}
	.caption, figcaption, caption {
		font-style: italic;
		font-size: 90%;
	}
	.caption::before, figcaption::before, figcaption > .marker {
		font-weight: bold;
	}
	.caption, figcaption {
		counter-increment: figure;
	}

	/* DL list is indented 2em, but figure inside it is not */
	dd > .figure, dd > figure { margin-left: -2em; }

/******************************************************************************/
/*                             Colored Boxes                                  */
/******************************************************************************/

	.issue, .note, .example, .assertion, .advisement, blockquote,
	.amendment, .correction, .addition {
		margin: 1em auto;
		padding: .5em;
		border: .5em;
		border-left-style: solid;
		page-break-inside: avoid;
	}
	span.issue, span.note {
		padding: .1em .5em .15em;
		border-right-style: solid;
	}

	blockquote > :first-child,
	.note  > p:first-child,
	.issue > p:first-child,
	.amendment > p:first-child,
	.correction > p:first-child,
	.addition > p:first-child {
		margin-top: 0;
	}
	blockquote > :last-child,
	.note  > p:last-child,
	.issue > p:last-child,
	.amendment > p:last-child,
	.correction > p:last-child,
	.addition > p:last-child {
		margin-bottom: 0;
	}


	.issue::before, .issue > .marker,
	.example::before, .example > .marker,
	.note::before, .note > .marker,
	details.note > summary > .marker,
	.amendment::before, .amendment > .marker,
	details.amendment > summary > .marker,
	.addition::before, .addition > .marker,
	addition.amendment > summary > .marker,
	.correction::before, .correction > .marker,
	correction.amendment > summary > .marker
	{
		text-transform: uppercase;
		padding-right: 1em;
	}

	.example::before, .example > .marker {
		display: block;
		padding-right: 0em;
	}

/** Blockquotes ***************************************************************/

	blockquote {
		border-color: silver;
		border-color: var(--blockquote-border);
		background: transparent;
		background: var(--blockquote-bg);
		color: currentcolor;
		color: var(--blockquote-text);
	}

/** Open issue ****************************************************************/

	.issue {
		border-color: #e05252;
		border-color: var(--issue-border);
		background: #fbe9e9;
		background: var(--issue-bg);
		color: black;
		color: var(--issue-text);
		counter-increment: issue;
		overflow: auto;
	}
	.issue::before, .issue > .marker {
		color: #831616;
		color: var(--issueheading-text);
	}
	/* Add .issue::before { content: "Issue " counter(issue) " "; } for autogen numbers,
	  or use class="marker" to mark up the issue number in source. */

/** Example *******************************************************************/

	.example {
		border-color: #e0cb52;
		border-color: var(--example-border);
		background: #fcfaee;
		background: var(--example-bg);
		color: black;
		color: var(--example-text);
		counter-increment: example;
		overflow: auto;
		clear: both;
	}
	.example::before, .example > .marker {
		color: #574b0f;
		color: var(--exampleheading-text);
	}
	/* Add .example::before { content: "Example " counter(example) " "; } for autogen numbers,
	  or use class="marker" to mark up the example number in source. */

/** Non-normative Note ********************************************************/

	.note {
		border-color: #52e052;
		border-color: var(--note-border);
		background: #e9fbe9;
		background: var(--note-bg);
		color: black;
		color: var(--note-text);
		overflow: auto;
	}

	.note::before, .note > .marker,
	details.note > summary {
		color: hsl(120, 70%, 30%);
		color: var(--noteheading-text);
	}
	/* Add .note::before { content: "Note "; } for autogen label,
	  or use class="marker" to mark up the label in source. */

	details.note[open] > summary {
		border-bottom: 1px silver solid;
		border-bottom: 1px var(--notesummary-underline) solid;
	}

/** Assertion Box *************************************************************/
	/*  for assertions in algorithms */

	.assertion {
		border-color: #AAA;
		border-color: var(--assertion-border);
		background: #EEE;
		background: var(--assertion-bg);
		color: black;
		color: var(--assertion-text);
	}

/** Advisement Box ************************************************************/
	/*  for attention-grabbing normative statements */

	.advisement {
		border-color: orange;
		border-color: var(--advisement-border);
		border-style: none solid;
		background: #fec;
		background: var(--advisement-bg);
		color: black;
		color: var(--advisement-text);
	}
	strong.advisement {
		display: block;
		text-align: center;
	}
	.advisement::before, .advisement > .marker {
		color: #b35f00;
		color: var(--advisementheading-text);
	}

/** Amendment Box *************************************************************/

	.amendment, .correction, .addition {
		border-color: #330099;
		border-color: var(--amendment-border);
		background: #F5F0FF;
		background: var(--amendment-bg);
		color: black;
		color: var(--amendment-text);
	}
	.amendment.proposed, .correction.proposed, .addition.proposed {
		border-style: solid;
		border-block-width: 0.25em;
	}
	.amendment::before, .amendment > .marker,
	details.amendment > summary::before, details.amendment > summary > .marker,
	.correction::before, .correction > .marker,
	details.correction > summary::before, details.correction > summary > .marker,
	.addition::before, .addition > .marker,
	details.addition > summary::before, details.addition > summary > .marker {
		color: #220066;
		color: var(--amendmentheading-text);
	}
	.amendment.proposed::before, .amendment.proposed > .marker,
	details.amendment.proposed > summary::before, details.amendment.proposed > summary > .marker,
	.correction.proposed::before, .correction.proposed > .marker,
	details.correction.proposed > summary::before, details.correction.proposed > summary > .marker,
	.addition.proposed::before, .addition.proposed > .marker,
	details.addition.proposed > summary::before, details.addition.proposed > summary > .marker {
		font-weight: bold;
	}

/** Spec Obsoletion Notice ****************************************************/
	/* obnoxious obsoletion notice for older/abandoned specs. */

	details {
		display: block;
	}
	summary {
		font-weight: bolder;
	}

	.annoying-warning:not(details),
	details.annoying-warning:not([open]) > summary,
	details.annoying-warning[open] {
		background: hsla(40,100%,50%,0.95);
		background: var(--warning-bg);
		color: black;
		color: var(--warning-text);
		padding: .75em 1em;
		border: red;
		border: var(--warning-border);
		border-style: solid none;
		box-shadow: 0 2px 8px black;
		text-align: center;
	}
	.annoying-warning :last-child {
		margin-bottom: 0;
	}

@media not print {
	details.annoying-warning[open] {
		position: fixed;
		left: 0;
		right: 0;
		bottom: 2em;
		z-index: 1000;
	}
}

	details.annoying-warning:not([open]) > summary {
		text-align: center;
	}

/** Entity Definition Boxes ***************************************************/

	.def {
		padding: .5em 1em;
		background: #def;
		background: var(--def-bg);
		margin: 1.2em 0;
		border-left: 0.5em solid #8ccbf2;
		border-left: 0.5em solid var(--def-border);
		color: black;
		color: var(--def-text);
	}

/******************************************************************************/
/*                                    Tables                                  */
/******************************************************************************/

	th, td {
		text-align: left;
		text-align: start;
	}

/** Property/Descriptor Definition Tables *************************************/

	table.def {
		/* inherits .def box styling, see above */
		width: 100%;
		border-spacing: 0;
	}

	table.def td,
	table.def th {
		padding: 0.5em;
		vertical-align: baseline;
		border-bottom: 1px solid #bbd7e9;
		border-bottom: 1px solid var(--defrow-border);
	}

	table.def > tbody > tr:last-child th,
	table.def > tbody > tr:last-child td {
		border-bottom: 0;
	}

	table.def th {
		font-style: italic;
		font-weight: normal;
		padding-left: 1em;
		width: 3em;
	}

	/* For when values are extra-complex and need formatting for readability */
	table td.pre {
		white-space: pre-wrap;
	}

	/* A footnote at the bottom of a def table */
	table.def td.footnote {
		padding-top: 0.6em;
	}
	table.def td.footnote::before {
		content: " ";
		display: block;
		height: 0.6em;
		width: 4em;
		border-top: thin solid;
	}

/** Data tables (and properly marked-up index tables) *************************/
	/*
		<table class="data"> highlights structural relationships in a table
		when correct markup is used (e.g. thead/tbody, th vs. td, scope attribute)

		Use class="complex data" for particularly complicated tables --
		(This will draw more lines: busier, but clearer.)

		Use class="long" on table cells with paragraph-like contents
		(This will adjust text alignment accordingly.)
		Alternately use class="longlastcol" on tables, to have the last column assume "long".
	*/

	table {
		word-wrap: normal;
		overflow-wrap: normal;
		hyphens: manual;
	}

	table.data,
	table.index {
		margin: 1em auto;
		border-collapse: collapse;
		border: hidden;
		width: 100%;
	}
	table.data caption,
	table.index caption {
		max-width: 50em;
		margin: 0 auto 1em;
	}

	table.data td,  table.data th,
	table.index td, table.index th {
		padding: 0.5em 1em;
		border-width: 1px;
		border-color: silver;
		border-color: var(--datacell-border);
		border-top-style: solid;
	}

	table.data thead td:empty {
		padding: 0;
		border: 0;
	}

	table.data  thead,
	table.index thead,
	table.data  tbody,
	table.index tbody {
		border-bottom: 2px solid;
	}

	table.data colgroup,
	table.index colgroup {
		border-left: 2px solid;
	}

	table.data  tbody th:first-child,
	table.index tbody th:first-child  {
		border-right: 2px solid;
		border-top: 1px solid silver;
		border-top: 1px solid var(--datacell-border);
		padding-right: 1em;
	}

	table.data th[colspan],
	table.data td[colspan] {
		text-align: center;
	}

	table.complex.data th,
	table.complex.data td {
		border: 1px solid silver;
		border: 1px solid var(--datacell-border);
		text-align: center;
	}

	table.data.longlastcol td:last-child,
	table.data td.long {
		vertical-align: baseline;
		text-align: left;
	}

	table.data img {
		vertical-align: middle;
	}


/*
Alternate table alignment rules

	table.data,
	table.index {
		text-align: center;
	}

	table.data  thead th[scope="row"],
	table.index thead th[scope="row"] {
		text-align: right;
	}

	table.data  tbody th:first-child,
	table.index tbody th:first-child  {
		text-align: right;
	}

Possible extra rowspan handling

	table.data  tbody th[rowspan]:not([rowspan='1']),
	table.index tbody th[rowspan]:not([rowspan='1']),
	table.data  tbody td[rowspan]:not([rowspan='1']),
	table.index tbody td[rowspan]:not([rowspan='1']) {
		border-left: 1px solid silver;
	}

	table.data  tbody th[rowspan]:first-child,
	table.index tbody th[rowspan]:first-child,
	table.data  tbody td[rowspan]:first-child,
	table.index tbody td[rowspan]:first-child{
		border-left: 0;
		border-right: 1px solid silver;
	}
*/

/******************************************************************************/
/*                                  Indices                                   */
/******************************************************************************/


/** Table of Contents *********************************************************/

	.toc a {
		/* More spacing; use padding to make it part of the click target. */
		padding: 0.1rem 1px 0;
		/* Larger, more consistently-sized click target */
		display: block;
		/* Switch to using border-bottom for underlines */
		text-decoration: none;
		border-bottom: 1px solid;
		/* Reverse color scheme */
		color: black;
		color: var(--toclink-text);
		border-color: #3980b5;
		border-color: var(--toclink-underline);
	}
	.toc a:visited {
		color: black;
		color: var(--toclink-visited-text);
		border-color: #054572;
		border-color: var(--toclink-visited-underline);
	}
	.toc a:focus,
	.toc a:hover {
		background: rgba(75%, 75%, 75%, .25);
		background: var(--a-hover-bg);
		border-bottom-width: 3px;
		margin-bottom: -2px;
	}
	.toc a:not(:focus):not(:hover) {
		/* Allow colors to cascade through from link styling */
		border-bottom-color: transparent;
	}

	.toc, .toc ol, .toc ul, .toc li {
		list-style: none; /* Numbers must be inlined into source */
		/* because generated content isn't search/selectable and markers can't do multilevel yet */
		margin:  0;
		padding: 0;
	}
	.toc {
		line-height: 1.1em;
	}

	/* ToC not indented until third level, but font style & margins show hierarchy */
	.toc > li			{ font-weight: bold;   }
	.toc > li li		 { font-weight: normal; }
	.toc > li li li	  { font-size:   95%;	}
	.toc > li li li li	{ font-size:   90%;	}
	.toc > li li li li li { font-size:   85%;	}

	/* @supports not (display:grid) { */
		.toc > li			{ margin: 1.5rem 0;	}
		.toc > li li		 { margin: 0.3rem 0;	}
		.toc > li li li	  { margin-left: 2rem;   }

		/* Section numbers in a column of their own */
		.toc .secno {
			float: left;
			width: 4rem;
			white-space: nowrap;
		}
		.toc > li li li li .secno { font-size: 85%; }
		.toc > li li li li li .secno { font-size: 100%; }

		.toc li {
			clear: both;
		}

		:not(li) > .toc			 { margin-left:  5rem; }
		.toc .secno				 { margin-left: -5rem; }
		.toc > li li li .secno	  { margin-left: -7rem; }
		.toc > li li li li .secno	{ margin-left: -9rem; }
		.toc > li li li li li .secno { margin-left: -11rem; }

		/* Tighten up indentation in narrow ToCs */
		@media (max-width: 30em) {
			:not(li) > .toc			 { margin-left:  4rem; }
			.toc .secno				 { margin-left: -4rem; }
			.toc > li li li			 { margin-left:  1rem; }
			.toc > li li li .secno	  { margin-left: -5rem; }
			.toc > li li li li .secno	{ margin-left: -6rem; }
			.toc > li li li li li .secno { margin-left: -7rem; }
		}
		/* Loosen it on wide screens */
		@media screen and (min-width: 78em) {
			body:not(.toc-inline) :not(li) > .toc			 { margin-left:  4rem; }
			body:not(.toc-inline) .toc .secno				 { margin-left: -4rem; }
			body:not(.toc-inline) .toc > li li li			 { margin-left:  1rem; }
			body:not(.toc-inline) .toc > li li li .secno	  { margin-left: -5rem; }
			body:not(.toc-inline) .toc > li li li li .secno	{ margin-left: -6rem; }
			body:not(.toc-inline) .toc > li li li li li .secno { margin-left: -7rem; }
	}
	/* } */

	@supports (display:grid) and (display:contents) {
		/* Use #toc over .toc to override non-@supports rules. */
		#toc {
			display: grid;
			align-content: start;
			grid-template-columns: auto 1fr;
			grid-column-gap: 1rem;
			column-gap: 1rem;
			grid-row-gap: .6rem;
			row-gap: .6rem;
		}
		#toc h2 {
			grid-column: 1 / -1;
			margin-bottom: 0;
		}
		#toc ol,
		#toc li,
		#toc a {
			display: contents;
			/* Switch <a> to subgrid when supported */
		}
		#toc span {
			margin: 0;
		}
		#toc > .toc > li > a > span {
			/* The spans of the top-level list,
			  comprising the first items of each top-level section. */
			margin-top: 1.1rem;
		}
		#toc#toc .secno { /* Ugh, need more specificity to override base.css */
			grid-column: 1;
			width: auto;
			margin-left: 0;
		}
		#toc .content {
			grid-column: 2;
			width: auto;
			margin-right: 1rem;
		}
		#toc .content:hover,
		#toc .content:focus {
			background: rgba(75%, 75%, 75%, .25);
			background: var(--a-hover-bg);
			border-bottom: 3px solid #054572;
			border-bottom: 3px solid var(--toclink-underline);
			margin-bottom: -3px;
		}
		#toc li li li .content {
			margin-left: 1rem;
		}
		#toc li li li li .content {
			margin-left: 2rem;
		}
	}


/** Index *********************************************************************/

	/* Index Lists: Layout */
	ul.index	  { margin-left: 0; columns: 15em; text-indent: 1em hanging; }
	ul.index li	{ margin-left: 0; list-style: none; break-inside: avoid; }
	ul.index li li { margin-left: 1em; }
	ul.index dl	{ margin-top: 0; }
	ul.index dt	{ margin: .2em 0 .2em 20px;}
	ul.index dd	{ margin: .2em 0 .2em 40px;}
	/* Index Lists: Typography */
	ul.index ul,
	ul.index dl { font-size: smaller; }
	@media not print {
		ul.index li a + span {
			white-space: nowrap;
			color: transparent; }
		ul.index li a:hover + span,
		ul.index li a:focus + span {
			color: #707070;
			color: var(--indexinfo-text);
		}
	}

/** Index Tables *****************************************************/
	/* See also the data table styling section, which this effectively subclasses */

	table.index {
		font-size: small;
		border-collapse: collapse;
		border-spacing: 0;
		text-align: left;
		margin: 1em 0;
	}

	table.index td,
	table.index th {
		padding: 0.4em;
	}

	table.index tr:hover td:not([rowspan]),
	table.index tr:hover th:not([rowspan]) {
		color: black;
		color: var(--indextable-hover-text);
		background: #f7f8f9;
		background: var(--indextable-hover-bg);
	}

	/* The link in the first column in the property table (formerly a TD) */
	table.index th:first-child a {
		font-weight: bold;
	}

/** Outdated warning **********************************************************/

.outdated-spec {
	color: black;
	color: var(--outdatedspec-text);
	background-color: rgba(0,0,0,0.5);
	background-color: var(--outdatedspec-bg);
}

.outdated-warning {
	position: fixed;
	bottom: 50%;
	left: 0;
	right: 0;
	margin: 0 auto;
	width: 50%;
	background: maroon;
	background: var(--outdated-bg);
	color: white;
	color: var(--outdated-text);
	border-radius: 1em;
	box-shadow: 0 0 1em red;
	box-shadow: 0 0 1em var(--outdated-shadow);
	padding: 2em;
	text-align: center;
	z-index: 2;
}

.outdated-warning a {
	color: currentcolor;
	background: transparent;
}

.edited-rec-warning {
	background: darkorange;
	background: var(--editedrec-bg);
	box-shadow: 0 0 1em;
}

.outdated-warning button {
	color: var(--outdated-text);
	border-radius: 1em;
	box-shadow: 0 0 1em red;
	box-shadow: 0 0 1em var(--outdated-shadow);
	padding: 2em;
	text-align: center;
	z-index: 2;
}

.outdated-warning a {
	color: currentcolor;
	background: transparent;
}

.edited-rec-warning {
	background: darkorange;
	background: var(--editedrec-bg);
	box-shadow: 0 0 1em;
}

.outdated-warning button {
	position: absolute;
	top: 0;
	right:0;
	margin: 0;
	border: 0;
	padding: 0.25em 0.5em;
	background: transparent;
	color: white;
	color: var(--outdated-text);
	font:1em sans-serif;
	text-align:center;
}

.outdated-warning span {
	display: block;
}

.outdated-collapsed {
	bottom: 0;
	border-radius: 0;
	width: 100%;
	padding: 0;
}

/******************************************************************************/
/*                                    Print                                   */
/******************************************************************************/

	@media print {
		/* Pages have their own margins. */
		html {
			margin: 0;
		}
		/* Serif for print. */
		body {
			font-family: serif;
		}

		.outdated-warning {
			position: absolute;
			border-style: solid;
			border-color: red;
		}

		.outdated-warning input {
			display: none;
		}
	}
	@page {
		margin: 1.5cm 1.1cm;
	}



/******************************************************************************/
/*                             Overflow Control                               */
/******************************************************************************/

	.figure .caption, .sidefigure .caption, figcaption {
		/* in case figure is overlarge, limit caption to 50em */
		max-width: 50rem;
		margin-left: auto;
		margin-right: auto;
	}
	.overlarge {
		/* Magic to create good item positioning:
		  "content column" is 50ems wide at max; less on smaller screens.
		  Extra space (after ToC + content) is empty on the right.

		  1. When item < content column, centers item in column.
		  2. When content < item < available, left-aligns.
		  3. When item > available, fills available + scroll bar.
		*/
		display: grid;
		grid-template-columns: minmax(0, 50em);
	}
	.overlarge > table {
		/* limit preferred width of table */
		max-width: 50em;
		margin-left: auto;
		margin-right: auto;
	}

	@media (min-width: 55em) {
		.overlarge {
			margin-right: calc(13px + 26.5rem - 50vw);
			max-width: none;
		}
	}
	@media screen and (min-width: 78em) {
		body:not(.toc-inline) .overlarge {
			/* 30.5em body padding 50em content area */
			margin-right: calc(40em - 50vw) !important;
		}
	}
	@media screen and (min-width: 90em) {
		body:not(.toc-inline) .overlarge {
			/* 4em html margin 30.5em body padding 50em content area */
			margin-right: calc(84.5em - 100vw) !important;
		}
	}

	@media not print {
		.overlarge {
			overflow-x: auto;
			/* See Lea Verou's explanation background-attachment:
			* http://lea.verou.me/2012/04/background-attachment-local/
			*
			background: top left  / 4em 100% linear-gradient(to right,  #ffffff, rgba(255, 255, 255, 0)) local,
						top right / 4em 100% linear-gradient(to left, #ffffff, rgba(255, 255, 255, 0)) local,
						top left  / 1em 100% linear-gradient(to right,  #c3c3c5, rgba(195, 195, 197, 0)) scroll,
						top right / 1em 100% linear-gradient(to left, #c3c3c5, rgba(195, 195, 197, 0)) scroll,
						white;
			background-repeat: no-repeat;
			*/
		}
	}
</style>
<style>
    table, th, td {
      border: 1px solid black;
      border-collapse: collapse;
      vertical-align: top;
    }
    th, td {
      border-left: none;
      border-right: none;
      padding: 0px 10px;
    }
    th {
      text-align: center;
    }

    del { background: #fcc; color: #000; text-decoration: line-through; }
    ins { background: #cfc; color: #000; }
    blockquote .highlight:not(.idl) { background: initial; margin: initial; padding: 0.5em }
    blockquote ul { background: inherit; }
    blockquote code.highlight:not(.idl) { padding: initial; }
    blockquote c-[a] { color: inherit; } /* Keyword.Declaration */
    blockquote c-[b] { color: inherit; } /* Keyword.Type */
    blockquote c-[c] { color: inherit; } /* Comment */
    blockquote c-[d] { color: inherit; } /* Comment.Multiline */
    blockquote c-[e] { color: inherit; } /* Name.Attribute */
    blockquote c-[f] { color: inherit; } /* Name.Tag */
    blockquote c-[g] { color: inherit; } /* Name.Variable */
    blockquote c-[k] { color: inherit; } /* Keyword */
    blockquote c-[l] { color: inherit; } /* Literal */
    blockquote c-[m] { color: inherit; } /* Literal.Number */
    blockquote c-[n] { color: inherit; } /* Name */
    blockquote c-[o] { color: inherit; } /* Operator */
    blockquote c-[p] { color: inherit; } /* Punctuation */
    blockquote c-[s] { color: inherit; } /* Literal.String */
    blockquote c-[t] { color: inherit; } /* Literal.String.Single */
    blockquote c-[u] { color: inherit; } /* Literal.String.Double */
    blockquote c-[cp] { color: inherit; } /* Comment.Preproc */
    blockquote c-[c1] { color: inherit; } /* Comment.Single */
    blockquote c-[cs] { color: inherit; } /* Comment.Special */
    blockquote c-[kc] { color: inherit; } /* Keyword.Constant */
    blockquote c-[kn] { color: inherit; } /* Keyword.Namespace */
    blockquote c-[kp] { color: inherit; } /* Keyword.Pseudo */
    blockquote c-[kr] { color: inherit; } /* Keyword.Reserved */
    blockquote c-[ld] { color: inherit; } /* Literal.Date */
    blockquote c-[nc] { color: inherit; } /* Name.Class */
    blockquote c-[no] { color: inherit; } /* Name.Constant */
    blockquote c-[nd] { color: inherit; } /* Name.Decorator */
    blockquote c-[ni] { color: inherit; } /* Name.Entity */
    blockquote c-[ne] { color: inherit; } /* Name.Exception */
    blockquote c-[nf] { color: inherit; } /* Name.Function */
    blockquote c-[nl] { color: inherit; } /* Name.Label */
    blockquote c-[nn] { color: inherit; } /* Name.Namespace */
    blockquote c-[py] { color: inherit; } /* Name.Property */
    blockquote c-[ow] { color: inherit; } /* Operator.Word */
    blockquote c-[mb] { color: inherit; } /* Literal.Number.Bin */
    blockquote c-[mf] { color: inherit; } /* Literal.Number.Float */
    blockquote c-[mh] { color: inherit; } /* Literal.Number.Hex */
    blockquote c-[mi] { color: inherit; } /* Literal.Number.Integer */
    blockquote c-[mo] { color: inherit; } /* Literal.Number.Oct */
    blockquote c-[sb] { color: inherit; } /* Literal.String.Backtick */
    blockquote c-[sc] { color: inherit; } /* Literal.String.Char */
    blockquote c-[sd] { color: inherit; } /* Literal.String.Doc */
    blockquote c-[se] { color: inherit; } /* Literal.String.Escape */
    blockquote c-[sh] { color: inherit; } /* Literal.String.Heredoc */
    blockquote c-[si] { color: inherit; } /* Literal.String.Interpol */
    blockquote c-[sx] { color: inherit; } /* Literal.String.Other */
    blockquote c-[sr] { color: inherit; } /* Literal.String.Regex */
    blockquote c-[ss] { color: inherit; } /* Literal.String.Symbol */
    blockquote c-[vc] { color: inherit; } /* Name.Variable.Class */
    blockquote c-[vg] { color: inherit; } /* Name.Variable.Global */
    blockquote c-[vi] { color: inherit; } /* Name.Variable.Instance */
    blockquote c-[il] { color: inherit; } /* Literal.Number.Integer.Long */
  </style>
  <meta content="Bikeshed version d9bd89757, updated Thu Mar 23 10:06:53 2023 -0700" name="generator">
  <link href="https://graymalk.in/iso-papers/p2850/p2850r0.html" rel="canonical">
  <link href="https://isocpp.org/favicon.ico" rel="icon">
  <meta content="9a32af6160c62392aeb250b94ca4ddafddc01408" name="document-revision">
<style>
  .rel {
    font-family: sans-serif;
    font-style: normal;
  }
  .dep { color: #920000; }
  .hb { color: forestgreen; }
  .mo { color: blue; }
  .rf { color: red; }
  .sb { color: #777; }
  .sdep { color: #ff8306; }
  .sw { color: rgb(139, 10, 80); }
</style>
<style>/* style-autolinks */
.css.css, .property.property, .descriptor.descriptor {
    color: var(--a-normal-text);
    font-size: inherit;
    font-family: inherit;
}
.css::before, .property::before, .descriptor::before {
    content: "‘";
}
.css::after, .property::after, .descriptor::after {
    content: "’";
}
.property, .descriptor {
    /* Don't wrap property and descriptor names */
    white-space: nowrap;
}
.type { /* CSS value <type> */
    font-style: italic;
}
pre .property::before, pre .property::after {
    content: "";
}
[data-link-type="property"]::before,
[data-link-type="propdesc"]::before,
[data-link-type="descriptor"]::before,
[data-link-type="value"]::before,
[data-link-type="function"]::before,
[data-link-type="at-rule"]::before,
[data-link-type="selector"]::before,
[data-link-type="maybe"]::before {
    content: "‘";
}
[data-link-type="property"]::after,
[data-link-type="propdesc"]::after,
[data-link-type="descriptor"]::after,
[data-link-type="value"]::after,
[data-link-type="function"]::after,
[data-link-type="at-rule"]::after,
[data-link-type="selector"]::after,
[data-link-type="maybe"]::after {
    content: "’";
}

[data-link-type].production::before,
[data-link-type].production::after,
.prod [data-link-type]::before,
.prod [data-link-type]::after {
    content: "";
}

[data-link-type=element],
[data-link-type=element-attr] {
    font-family: Menlo, Consolas, "DejaVu Sans Mono", monospace;
    font-size: .9em;
}
[data-link-type=element]::before { content: "<" }
[data-link-type=element]::after  { content: ">" }

[data-link-type=biblio] {
    white-space: pre;
}
</style>
<style>/* style-colors */

/* Any --*-text not paired with a --*-bg is assumed to have a transparent bg */
:root {
    color-scheme: light dark;

    --text: black;
    --bg: white;

    --unofficial-watermark: url(https://www.w3.org/StyleSheets/TR/2016/logos/UD-watermark);

    --logo-bg: #1a5e9a;
    --logo-active-bg: #c00;
    --logo-text: white;

    --tocnav-normal-text: #707070;
    --tocnav-normal-bg: var(--bg);
    --tocnav-hover-text: var(--tocnav-normal-text);
    --tocnav-hover-bg: #f8f8f8;
    --tocnav-active-text: #c00;
    --tocnav-active-bg: var(--tocnav-normal-bg);

    --tocsidebar-text: var(--text);
    --tocsidebar-bg: #f7f8f9;
    --tocsidebar-shadow: rgba(0,0,0,.1);
    --tocsidebar-heading-text: hsla(203,20%,40%,.7);

    --toclink-text: var(--text);
    --toclink-underline: #3980b5;
    --toclink-visited-text: var(--toclink-text);
    --toclink-visited-underline: #054572;

    --heading-text: #005a9c;

    --hr-text: var(--text);

    --algo-border: #def;

    --del-text: red;
    --del-bg: transparent;
    --ins-text: #080;
    --ins-bg: transparent;

    --a-normal-text: #034575;
    --a-normal-underline: #bbb;
    --a-visited-text: var(--a-normal-text);
    --a-visited-underline: #707070;
    --a-hover-bg: rgba(75%, 75%, 75%, .25);
    --a-active-text: #c00;
    --a-active-underline: #c00;

    --blockquote-border: silver;
    --blockquote-bg: transparent;
    --blockquote-text: currentcolor;

    --issue-border: #e05252;
    --issue-bg: #fbe9e9;
    --issue-text: var(--text);
    --issueheading-text: #831616;

    --example-border: #e0cb52;
    --example-bg: #fcfaee;
    --example-text: var(--text);
    --exampleheading-text: #574b0f;

    --note-border: #52e052;
    --note-bg: #e9fbe9;
    --note-text: var(--text);
    --noteheading-text: hsl(120, 70%, 30%);
    --notesummary-underline: silver;

    --assertion-border: #aaa;
    --assertion-bg: #eee;
    --assertion-text: black;

    --advisement-border: orange;
    --advisement-bg: #fec;
    --advisement-text: var(--text);
    --advisementheading-text: #b35f00;

    --warning-border: red;
    --warning-bg: hsla(40,100%,50%,0.95);
    --warning-text: var(--text);

    --amendment-border: #330099;
    --amendment-bg: #F5F0FF;
    --amendment-text: var(--text);
    --amendmentheading-text: #220066;

    --def-border: #8ccbf2;
    --def-bg: #def;
    --def-text: var(--text);
    --defrow-border: #bbd7e9;

    --datacell-border: silver;

    --indexinfo-text: #707070;

    --indextable-hover-text: black;
    --indextable-hover-bg: #f7f8f9;

    --outdatedspec-bg: rgba(0, 0, 0, .5);
    --outdatedspec-text: black;
    --outdated-bg: maroon;
    --outdated-text: white;
    --outdated-shadow: red;

    --editedrec-bg: darkorange;
}
</style>
<style>/* style-counters */
body {
    counter-reset: example figure issue;
}
.issue {
    counter-increment: issue;
}
.issue:not(.no-marker)::before {
    content: "Issue " counter(issue);
}

.example {
    counter-increment: example;
}
.example:not(.no-marker)::before {
    content: "Example " counter(example);
}
.invalid.example:not(.no-marker)::before,
.illegal.example:not(.no-marker)::before {
    content: "Invalid Example" counter(example);
}

figcaption {
    counter-increment: figure;
}
figcaption:not(.no-marker)::before {
    content: "Figure " counter(figure) " ";
}
</style>
<style>/* style-issues */
a[href].issue-return {
    float: right;
    float: inline-end;
    color: var(--issueheading-text);
    font-weight: bold;
    text-decoration: none;
}
</style>
<style>/* style-md-lists */
/* This is a weird hack for me not yet following the commonmark spec
   regarding paragraph and lists. */
[data-md] > :first-child {
    margin-top: 0;
}
[data-md] > :last-child {
    margin-bottom: 0;
}
</style>
<style>/* style-selflinks */

:root {
    --selflink-text: white;
    --selflink-bg: gray;
    --selflink-hover-text: black;
}
.heading, .issue, .note, .example, li, dt {
    position: relative;
}
a.self-link {
    position: absolute;
    top: 0;
    left: calc(-1 * (3.5rem - 26px));
    width: calc(3.5rem - 26px);
    height: 2em;
    text-align: center;
    border: none;
    transition: opacity .2s;
    opacity: .5;
}
a.self-link:hover {
    opacity: 1;
}
.heading > a.self-link {
    font-size: 83%;
}
.example > a.self-link,
.note > a.self-link,
.issue > a.self-link {
    /* These blocks are overflow:auto, so positioning outside
       doesn't work. */
    left: auto;
    right: 0;
}
li > a.self-link {
    left: calc(-1 * (3.5rem - 26px) - 2em);
}
dfn > a.self-link {
    top: auto;
    left: auto;
    opacity: 0;
    width: 1.5em;
    height: 1.5em;
    background: var(--selflink-bg);
    color: var(--selflink-text);
    font-style: normal;
    transition: opacity .2s, background-color .2s, color .2s;
}
dfn:hover > a.self-link {
    opacity: 1;
}
dfn > a.self-link:hover {
    color: var(--selflink-hover-text);
}

a.self-link::before            { content: "¶"; }
.heading > a.self-link::before { content: "§"; }
dfn > a.self-link::before      { content: "#"; }
</style>
<style>/* style-syntax-highlighting */

code.highlight { padding: .1em; border-radius: .3em; }
pre.highlight, pre > code.highlight { display: block; padding: 1em; margin: .5em 0; overflow: auto; border-radius: 0; }

.highlight:not(.idl) { background: rgba(0, 0, 0, .03); }
c-[a] { color: #990055 } /* Keyword.Declaration */
c-[b] { color: #990055 } /* Keyword.Type */
c-[c] { color: #708090 } /* Comment */
c-[d] { color: #708090 } /* Comment.Multiline */
c-[e] { color: #0077aa } /* Name.Attribute */
c-[f] { color: #669900 } /* Name.Tag */
c-[g] { color: #222222 } /* Name.Variable */
c-[k] { color: #990055 } /* Keyword */
c-[l] { color: #000000 } /* Literal */
c-[m] { color: #000000 } /* Literal.Number */
c-[n] { color: #0077aa } /* Name */
c-[o] { color: #999999 } /* Operator */
c-[p] { color: #999999 } /* Punctuation */
c-[s] { color: #a67f59 } /* Literal.String */
c-[t] { color: #a67f59 } /* Literal.String.Single */
c-[u] { color: #a67f59 } /* Literal.String.Double */
c-[cp] { color: #708090 } /* Comment.Preproc */
c-[c1] { color: #708090 } /* Comment.Single */
c-[cs] { color: #708090 } /* Comment.Special */
c-[kc] { color: #990055 } /* Keyword.Constant */
c-[kn] { color: #990055 } /* Keyword.Namespace */
c-[kp] { color: #990055 } /* Keyword.Pseudo */
c-[kr] { color: #990055 } /* Keyword.Reserved */
c-[ld] { color: #000000 } /* Literal.Date */
c-[nc] { color: #0077aa } /* Name.Class */
c-[no] { color: #0077aa } /* Name.Constant */
c-[nd] { color: #0077aa } /* Name.Decorator */
c-[ni] { color: #0077aa } /* Name.Entity */
c-[ne] { color: #0077aa } /* Name.Exception */
c-[nf] { color: #0077aa } /* Name.Function */
c-[nl] { color: #0077aa } /* Name.Label */
c-[nn] { color: #0077aa } /* Name.Namespace */
c-[py] { color: #0077aa } /* Name.Property */
c-[ow] { color: #999999 } /* Operator.Word */
c-[mb] { color: #000000 } /* Literal.Number.Bin */
c-[mf] { color: #000000 } /* Literal.Number.Float */
c-[mh] { color: #000000 } /* Literal.Number.Hex */
c-[mi] { color: #000000 } /* Literal.Number.Integer */
c-[mo] { color: #000000 } /* Literal.Number.Oct */
c-[sb] { color: #a67f59 } /* Literal.String.Backtick */
c-[sc] { color: #a67f59 } /* Literal.String.Char */
c-[sd] { color: #a67f59 } /* Literal.String.Doc */
c-[se] { color: #a67f59 } /* Literal.String.Escape */
c-[sh] { color: #a67f59 } /* Literal.String.Heredoc */
c-[si] { color: #a67f59 } /* Literal.String.Interpol */
c-[sx] { color: #a67f59 } /* Literal.String.Other */
c-[sr] { color: #a67f59 } /* Literal.String.Regex */
c-[ss] { color: #a67f59 } /* Literal.String.Symbol */
c-[vc] { color: #0077aa } /* Name.Variable.Class */
c-[vg] { color: #0077aa } /* Name.Variable.Global */
c-[vi] { color: #0077aa } /* Name.Variable.Instance */
c-[il] { color: #000000 } /* Literal.Number.Integer.Long */
</style>
<style>/* style-darkmode */

@media (prefers-color-scheme: dark) {
    :root {
        --text: #ddd;
        --bg: black;

        --unofficial-watermark: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='400' height='400'%3E%3Cg fill='%23100808' transform='translate(200 200) rotate(-45) translate(-200 -200)' stroke='%23100808' stroke-width='3'%3E%3Ctext x='50%25' y='220' style='font: bold 70px sans-serif; text-anchor: middle; letter-spacing: 6px;'%3EUNOFFICIAL%3C/text%3E%3Ctext x='50%25' y='305' style='font: bold 70px sans-serif; text-anchor: middle; letter-spacing: 6px;'%3EDRAFT%3C/text%3E%3C/g%3E%3C/svg%3E");

        --logo-bg: #1a5e9a;
        --logo-active-bg: #c00;
        --logo-text: white;

        --tocnav-normal-text: #999;
        --tocnav-normal-bg: var(--bg);
        --tocnav-hover-text: var(--tocnav-normal-text);
        --tocnav-hover-bg: #080808;
        --tocnav-active-text: #f44;
        --tocnav-active-bg: var(--tocnav-normal-bg);

        --tocsidebar-text: var(--text);
        --tocsidebar-bg: #080808;
        --tocsidebar-shadow: rgba(255,255,255,.1);
        --tocsidebar-heading-text: hsla(203,20%,40%,.7);

        --toclink-text: var(--text);
        --toclink-underline: #6af;
        --toclink-visited-text: var(--toclink-text);
        --toclink-visited-underline: #054572;

        --heading-text: #8af;

        --hr-text: var(--text);

        --algo-border: #456;

        --del-text: #f44;
        --del-bg: transparent;
        --ins-text: #4a4;
        --ins-bg: transparent;

        --a-normal-text: #6af;
        --a-normal-underline: #555;
        --a-visited-text: var(--a-normal-text);
        --a-visited-underline: var(--a-normal-underline);
        --a-hover-bg: rgba(25%, 25%, 25%, .2);
        --a-active-text: #f44;
        --a-active-underline: var(--a-active-text);

        --borderedblock-bg: rgba(255, 255, 255, .05);

        --blockquote-border: silver;
        --blockquote-bg: var(--borderedblock-bg);
        --blockquote-text: currentcolor;

        --issue-border: #e05252;
        --issue-bg: var(--borderedblock-bg);
        --issue-text: var(--text);
        --issueheading-text: hsl(0deg, 70%, 70%);

        --example-border: hsl(50deg, 90%, 60%);
        --example-bg: var(--borderedblock-bg);
        --example-text: var(--text);
        --exampleheading-text: hsl(50deg, 70%, 70%);

        --note-border: hsl(120deg, 100%, 35%);
        --note-bg: var(--borderedblock-bg);
        --note-text: var(--text);
        --noteheading-text: hsl(120, 70%, 70%);
        --notesummary-underline: silver;

        --assertion-border: #444;
        --assertion-bg: var(--borderedblock-bg);
        --assertion-text: var(--text);

        --advisement-border: orange;
        --advisement-bg: #222218;
        --advisement-text: var(--text);
        --advisementheading-text: #f84;

        --warning-border: red;
        --warning-bg: hsla(40,100%,20%,0.95);
        --warning-text: var(--text);

        --amendment-border: #330099;
        --amendment-bg: #080010;
        --amendment-text: var(--text);
        --amendmentheading-text: #cc00ff;

        --def-border: #8ccbf2;
        --def-bg: #080818;
        --def-text: var(--text);
        --defrow-border: #136;

        --datacell-border: silver;

        --indexinfo-text: #aaa;

        --indextable-hover-text: var(--text);
        --indextable-hover-bg: #181818;

        --outdatedspec-bg: rgba(255, 255, 255, .5);
        --outdatedspec-text: black;
        --outdated-bg: maroon;
        --outdated-text: white;
        --outdated-shadow: red;

        --editedrec-bg: darkorange;
    }
    /* In case a transparent-bg image doesn't expect to be on a dark bg,
       which is quite common in practice... */
    img { background: white; }
}

@media (prefers-color-scheme: dark) {
    :root {
        --selflink-text: black;
        --selflink-bg: silver;
        --selflink-hover-text: white;
    }
}

@media (prefers-color-scheme: dark) {
    .highlight:not(.idl) { background: rgba(255, 255, 255, .05); }

    c-[a] { color: #d33682 } /* Keyword.Declaration */
    c-[b] { color: #d33682 } /* Keyword.Type */
    c-[c] { color: #2aa198 } /* Comment */
    c-[d] { color: #2aa198 } /* Comment.Multiline */
    c-[e] { color: #268bd2 } /* Name.Attribute */
    c-[f] { color: #b58900 } /* Name.Tag */
    c-[g] { color: #cb4b16 } /* Name.Variable */
    c-[k] { color: #d33682 } /* Keyword */
    c-[l] { color: #657b83 } /* Literal */
    c-[m] { color: #657b83 } /* Literal.Number */
    c-[n] { color: #268bd2 } /* Name */
    c-[o] { color: #657b83 } /* Operator */
    c-[p] { color: #657b83 } /* Punctuation */
    c-[s] { color: #6c71c4 } /* Literal.String */
    c-[t] { color: #6c71c4 } /* Literal.String.Single */
    c-[u] { color: #6c71c4 } /* Literal.String.Double */
    c-[ch] { color: #2aa198 } /* Comment.Hashbang */
    c-[cp] { color: #2aa198 } /* Comment.Preproc */
    c-[cpf] { color: #2aa198 } /* Comment.PreprocFile */
    c-[c1] { color: #2aa198 } /* Comment.Single */
    c-[cs] { color: #2aa198 } /* Comment.Special */
    c-[kc] { color: #d33682 } /* Keyword.Constant */
    c-[kn] { color: #d33682 } /* Keyword.Namespace */
    c-[kp] { color: #d33682 } /* Keyword.Pseudo */
    c-[kr] { color: #d33682 } /* Keyword.Reserved */
    c-[ld] { color: #657b83 } /* Literal.Date */
    c-[nc] { color: #268bd2 } /* Name.Class */
    c-[no] { color: #268bd2 } /* Name.Constant */
    c-[nd] { color: #268bd2 } /* Name.Decorator */
    c-[ni] { color: #268bd2 } /* Name.Entity */
    c-[ne] { color: #268bd2 } /* Name.Exception */
    c-[nf] { color: #268bd2 } /* Name.Function */
    c-[nl] { color: #268bd2 } /* Name.Label */
    c-[nn] { color: #268bd2 } /* Name.Namespace */
    c-[py] { color: #268bd2 } /* Name.Property */
    c-[ow] { color: #657b83 } /* Operator.Word */
    c-[mb] { color: #657b83 } /* Literal.Number.Bin */
    c-[mf] { color: #657b83 } /* Literal.Number.Float */
    c-[mh] { color: #657b83 } /* Literal.Number.Hex */
    c-[mi] { color: #657b83 } /* Literal.Number.Integer */
    c-[mo] { color: #657b83 } /* Literal.Number.Oct */
    c-[sa] { color: #6c71c4 } /* Literal.String.Affix */
    c-[sb] { color: #6c71c4 } /* Literal.String.Backtick */
    c-[sc] { color: #6c71c4 } /* Literal.String.Char */
    c-[dl] { color: #6c71c4 } /* Literal.String.Delimiter */
    c-[sd] { color: #6c71c4 } /* Literal.String.Doc */
    c-[se] { color: #6c71c4 } /* Literal.String.Escape */
    c-[sh] { color: #6c71c4 } /* Literal.String.Heredoc */
    c-[si] { color: #6c71c4 } /* Literal.String.Interpol */
    c-[sx] { color: #6c71c4 } /* Literal.String.Other */
    c-[sr] { color: #6c71c4 } /* Literal.String.Regex */
    c-[ss] { color: #6c71c4 } /* Literal.String.Symbol */
    c-[fm] { color: #268bd2 } /* Name.Function.Magic */
    c-[vc] { color: #cb4b16 } /* Name.Variable.Class */
    c-[vg] { color: #cb4b16 } /* Name.Variable.Global */
    c-[vi] { color: #cb4b16 } /* Name.Variable.Instance */
    c-[vm] { color: #cb4b16 } /* Name.Variable.Magic */
    c-[il] { color: #657b83 } /* Literal.Number.Integer.Long */
}
</style>
 <body class="h-entry">
  <div class="head">
   <p data-fill-with="logo"></p>
   <h1 class="p-name no-ref" id="title">P2850R0<br>Minimal Compiler Preserved Dependencies</h1>
   <h2 class="no-num no-toc no-ref heading settled" id="profile-and-date"><span class="content">Published Proposal, <time class="dt-updated" datetime="2023-06-12">2023-06-12</time></span></h2>
   <div data-fill-with="spec-metadata">
    <dl>
     <dt>This version:
     <dd><a class="u-url" href="https://graymalk.in/iso-papers/p2850/p2850r0.html">https://graymalk.in/iso-papers/p2850/p2850r0.html</a>
     <dt class="editor">Authors:
     <dd class="editor p-author h-card vcard"><a class="p-name fn u-email email" href="mailto:M.J.Batty@kent.ac.uk">Mark Batty</a> (<span class="p-org org">University of Kent</span>)
     <dd class="editor p-author h-card vcard"><a class="p-name fn u-email email" href="mailto:simon@graymalk.in">Simon Cooksey</a> (<span class="p-org org">University of Kent</span>)
     <dt>Audience:
     <dd>SG1
     <dt>Project:
     <dd>ISO/IEC JTC1/SC22/WG21 14882: Programming Language — C++
    </dl>
   </div>
   <div data-fill-with="warning"></div>
   <hr title="Separator for header">
  </div>
  <div class="p-summary" data-fill-with="abstract">
   <h2 class="no-num no-toc no-ref heading settled" id="abstract"><span class="content">Abstract</span></h2>
   <p>This paper is a step in integrating semantic dependency into the C++ standard in order to fix the longstanding thin-air problem. It explains semantic dependency with examples and then poses questions to WG21 members on the finer details of C++ compiler behaviour.</p>
  </div>
  <nav data-fill-with="table-of-contents" id="toc">
   <h2 class="no-num no-toc no-ref" id="contents">Table of Contents</h2>
   <ol class="toc" role="directory">
    <li><a href="#thanks"><span class="secno">1</span> <span class="content">Thanks</span></a>
    <li>
     <a href="#intro"><span class="secno">2</span> <span class="content">Introduction</span></a>
     <ol class="toc">
      <li><a href="#lb"><span class="secno">2.1</span> <span class="content">Load buffering</span></a>
      <li><a href="#lb+datas"><span class="secno">2.2</span> <span class="content">Load buffering with data dependencies</span></a>
      <li><a href="#lb+ctrls"><span class="secno">2.3</span> <span class="content">Load buffering with control dependency</span></a>
      <li><a href="#lb+false-deps"><span class="secno">2.4</span> <span class="content">Load buffering with false-dependency</span></a>
      <li><a href="#hotspot"><span class="secno">2.5</span> <span class="content">Java Hotspot</span></a>
      <li><a href="#jctc18"><span class="secno">2.6</span> <span class="content">Java Causality Test Case 18</span></a>
     </ol>
    <li>
     <a href="#tea"><span class="secno">3</span> <span class="content">Controversial Tests</span></a>
     <ol class="toc">
      <li><a href="#goldblatt"><span class="secno">3.1</span> <span class="content">Goldblatt alignment</span></a>
      <li><a href="#rfub"><span class="secno">3.2</span> <span class="content">RFUB</span></a>
      <li><a href="#oota4"><span class="secno">3.3</span> <span class="content">OOTA4</span></a>
      <li><a href="#cohcyc"><span class="secno">3.4</span> <span class="content">CohCYC</span></a>
      <li><a href="#freeze"><span class="secno">3.5</span> <span class="content">Freeze Example</span></a>
     </ol>
    <li>
     <a href="#jct"><span class="secno">4</span> <span class="content"><span class="rel sdep">sdep</span> in Java Causality Tests</span></a>
     <ol class="toc">
      <li><a href="#jctc1"><span class="secno">4.1</span> <span class="content">JCTC1</span></a>
      <li><a href="#jctc2"><span class="secno">4.2</span> <span class="content">JCTC2</span></a>
      <li><a href="#jctc3"><span class="secno">4.3</span> <span class="content">JCTC3</span></a>
      <li><a href="#jctc4"><span class="secno">4.4</span> <span class="content">JCTC4</span></a>
      <li><a href="#jctc5"><span class="secno">4.5</span> <span class="content">JCTC5</span></a>
      <li><a href="#jctc6"><span class="secno">4.6</span> <span class="content">JCTC6</span></a>
      <li><a href="#jctc7"><span class="secno">4.7</span> <span class="content">JCTC7</span></a>
      <li><a href="#jctc8"><span class="secno">4.8</span> <span class="content">JCTC8</span></a>
      <li><a href="#jctc9"><span class="secno">4.9</span> <span class="content">JCTC9</span></a>
      <li><a href="#jctc10"><span class="secno">4.10</span> <span class="content">JCTC10</span></a>
      <li><a href="#jctc11"><span class="secno">4.11</span> <span class="content">JCTC11</span></a>
      <li><a href="#jctc12"><span class="secno">4.12</span> <span class="content">JCTC12</span></a>
      <li><a href="#jctc13"><span class="secno">4.13</span> <span class="content">JCTC13</span></a>
      <li><a href="#jctc14"><span class="secno">4.14</span> <span class="content">JCTC14</span></a>
      <li><a href="#jctc15"><span class="secno">4.15</span> <span class="content">JCTC15</span></a>
      <li><a href="#jctc16"><span class="secno">4.16</span> <span class="content">JCTC16</span></a>
      <li><a href="#jctc17"><span class="secno">4.17</span> <span class="content">JCTC17</span></a>
      <li><a href="#jctc18-again"><span class="secno">4.18</span> <span class="content">JCTC18</span></a>
      <li><a href="#jctc19"><span class="secno">4.19</span> <span class="content">JCTC19</span></a>
      <li><a href="#jctc20"><span class="secno">4.20</span> <span class="content">JCTC20</span></a>
     </ol>
    <li>
     <a href="#references"><span class="secno"></span> <span class="content">References</span></a>
     <ol class="toc">
      <li><a href="#informative"><span class="secno"></span> <span class="content">Informative References</span></a>
     </ol>
   </ol>
  </nav>
  <main>
   <h2 class="heading settled" data-level="1" id="thanks"><span class="secno">1. </span><span class="content">Thanks</span><a class="self-link" href="#thanks"></a></h2>
   <p>Our thanks go to the many people who have contributed to this discussion over many years.
Hans Boehm,
Soham Chakraborty,
David Goldblatt,
Chung-Kil Hur,
Alan Jeffrey,
Ori Lahav,
Paul McKenney,
Scott Owens,
Anouk Paradis,
Marco Paviotti,
William Pugh,
James Riely,
Jaroslav Ševčík,
Ben Simner,
Viktor Vafeiadis,
Daniel Wright,
and others!</p>
   <h2 class="heading settled" data-level="2" id="intro"><span class="secno">2. </span><span class="content">Introduction</span><a class="self-link" href="#intro"></a></h2>
   <p>This paper is a step in integrating <em>semantic dependency</em> (<span class="rel sdep">sdep</span>) into the C++ standard in order to fix the longstanding thin-air problem. It explains <span class="rel sdep">sdep</span> with examples and then poses questions to SG1 members on the finer details of C++ compiler behaviour.</p>
   <p><span class="rel sdep">sdep</span> is intended to capture a minimum set of ordering implicit in the data, control and address dependencies of a program -- <span class="rel sdep">sdep</span> is made up of only the dependencies that <em>must</em> be preserved by an optimising C++ compiler. <a data-link-type="biblio" href="#biblio-p1780" title="Modular Relaxed Dependencies: A new approach to the Out-Of-Thin-Air Problem">[P1780]</a> (Kona 2022) provided standards text introducing <span class="rel sdep">sdep</span> as an implementation-defined relation, restricted by a technical report, auxilliary to the standard. Adding <span class="rel sdep">sdep</span> is a small change to the standard that fixes a deep problem, avoiding a rewrite of the concurrency specification. We hope this paper will lead to the auxilliary technical report by defining cases where there must be <span class="rel sdep">sdep</span>, and the compiler may not optimse, and cases where the compiler must be free to optimise, so there can be no <span class="rel sdep">sdep</span>.</p>
   <p>We use small example programs with defined outcomes called <em>litmus tests</em> to introduce <span class="rel sdep">sdep</span>, and then to discuss the corner cases where the C++ standard should limit the compiler’s optimiser to preseve program order. By convention, locations in litmus tests are atomic and memory accesses are <code class="highlight"><c- n>memory_order_relaxed</c-></code> unless otherwise stated.</p>
   <p>Target architectures like ARM and POWER allow <em>relaxed</em> concurrent behaviours, that cannot be explained by any sequential scheduling of the memory events in the program. The following litmus test, called Load Buffering (LB), can produce the outcome <code class="highlight"><c- n>r1</c-> <c- o>==</c-> <c- mi>1</c-> <c- o>&amp;&amp;</c-> <c- n>r2</c-> <c- o>==</c-> <c- mi>1</c-></code> when translated directly to POWER and ARM targets, so C++ relaxed atomics must be allowed to witness this same behaviour. Similarly, optimisers can reorder events, permitting this behavior even on targets whose architectures forbid the relaxed behaviour.</p>
   <h3 class="heading settled" data-level="2.1" id="lb"><span class="secno">2.1. </span><span class="content">Load buffering</span><a class="self-link" href="#lb"></a></h3>
<pre class="language-c++ highlight"><c- c1>// Init:</c->
<c- nl>x</c-> <c- p>:</c-><c- o>=</c-> <c- mi>0</c-><c- p>;</c->
<c- nl>y</c-> <c- p>:</c-><c- o>=</c-> <c- mi>0</c-><c- p>;</c->

<c- c1>// Thread 0:</c->
<c- nl>r1</c-> <c- p>:</c-><c- o>=</c-> <c- n>x</c-><c- p>;</c->
<c- nl>y</c-> <c- p>:</c-><c- o>=</c-> <c- mi>1</c->

<c- c1>// Thread 1:</c->
<c- nl>r2</c-> <c- p>:</c-><c- o>=</c-> <c- n>y</c-><c- p>;</c->
<c- nl>x</c-> <c- p>:</c-><c- o>=</c-> <c- mi>1</c->
</pre>
   <p>The concurrent behaviour of a program is defined by the C++ memory model as a set of <em>executions</em> -- graphs of the memory events performed in one path of the program’s control flow. The memory reads, writes and fences make up the nodes, the black edges represent <em>sequenced before</em>, <span class="rel sb">sb</span>, and the red edges represent <em>reads from</em>, <span class="rel rf">rf</span>, indicating which write each read is reading from. The memory model forbids executions that have the wrong kind of cycles in these relations, but because we must allow the relaxed outcome in the LB test, it cannot forbid executions containing a cycle in <span class="rel sb">sb</span> and <span class="rel rf">rf</span> as below.</p>
   <p><img alt="Load buffering" height="457" src="./tests/lb.png" width="433"></p>
   <p>There is a flaw in the existing C++ standard where, in an attempt to allow aggressive compiler optimisation, the language definition goes too far, allowing programs to produce values out of thin air. The test below, LB+datas, is a variant of LB where the values written are taken from the values read on each thread.</p>
   <h3 class="heading settled" data-level="2.2" id="lb+datas"><span class="secno">2.2. </span><span class="content">Load buffering with data dependencies</span><a class="self-link" href="#lb+datas"></a></h3>
<pre class="language-c++ highlight"><c- c1>// Init:</c->
<c- nl>x</c-> <c- p>:</c-><c- o>=</c-> <c- mi>0</c-><c- p>;</c->
<c- nl>y</c-> <c- p>:</c-><c- o>=</c-> <c- mi>0</c-><c- p>;</c->

<c- c1>// Thread 0:</c->
<c- nl>r1</c-> <c- p>:</c-><c- o>=</c-> <c- n>x</c-><c- p>;</c->
<c- nl>y</c-> <c- p>:</c-><c- o>=</c-> <c- n>r1</c->

<c- c1>// Thread 1:</c->
<c- nl>r2</c-> <c- p>:</c-><c- o>=</c-> <c- n>y</c-><c- p>;</c->
<c- nl>x</c-> <c- p>:</c-><c- o>=</c-> <c- n>r2</c->
</pre>
   <p>The standard allows the outcomes <code class="highlight"><c- n>r1</c-> <c- o>==</c-> <c- mi>1</c-> <c- o>&amp;&amp;</c-> <c- n>r2</c-> <c- o>==</c-> <c- mi>1</c-></code> or even <code class="highlight"><c- n>r1</c-> <c- o>==</c-> <c- mi>42</c-> <c- o>&amp;&amp;</c-> <c- n>r2</c-> <c- o>==</c-> <c- mi>42</c-></code> despite the only writes in the program being of value <code class="highlight"><c- mi>0</c-></code>: the values <code class="highlight"><c- mi>1</c-></code> and <code class="highlight"><c- mi>42</c-></code> come <em>out of thin air</em>. This is a problem: no combination of compiler optimisations and quirks of the target architecture admits this behaviour, and allowing it is known to make it impossible to prove C++ code correct -- the standard must be changed to forbid this outcome <a data-link-type="biblio" href="#biblio-problem" title="The Problem of Programming Language Concurrency Semantics">[Problem]</a>.</p>
   <p><img alt="Load buffering with data dependencies" height="457" src="./tests/lb+datas.png" width="433"></p>
   <p>The curved arrows in the executions are <em>dependency edges</em> they reflect the fact that the values written by the writes are data dependent on the values read. In the previous test, LB, there were no dependency edges because concrete values were written making the writes independent. By forbidding cycles in dependency and <span class="rel rf">rf</span>, we could forbid the relaxed outcome here, but keep the outcome in the LB test, just as we need to. Note that this choice restricts the compiler: the specification requires the compiler to keep the accesses in order in LB+datas. That is not an onerous resrtiction: we do not expect the compiler to optimise here.</p>
   <p>The next test demonstrates that conditional statements can create dependencies too.</p>
   <h3 class="heading settled" data-level="2.3" id="lb+ctrls"><span class="secno">2.3. </span><span class="content">Load buffering with control dependency</span><a class="self-link" href="#lb+ctrls"></a></h3>
<pre class="language-c++ highlight"><c- c1>// Init:</c->
<c- nl>x</c-> <c- p>:</c-><c- o>=</c-> <c- mi>0</c-><c- p>;</c->
<c- nl>y</c-> <c- p>:</c-><c- o>=</c-> <c- mi>0</c-><c- p>;</c->

<c- c1>// Thread 0:</c->
<c- nl>r1</c-> <c- p>:</c-><c- o>=</c-> <c- n>x</c-><c- p>;</c->
<c- k>if</c-><c- p>(</c-><c- n>r1</c-> <c- o>==</c-> <c- mi>1</c-><c- p>)</c-> <c- p>{</c->
  <c- nl>y</c-> <c- p>:</c-><c- o>=</c-> <c- n>r1</c->
<c- p>}</c->

<c- c1>// Thread 1:</c->
<c- nl>r2</c-> <c- p>:</c-><c- o>=</c-> <c- n>y</c-><c- p>;</c->
<c- k>if</c-><c- p>(</c-><c- n>r2</c-> <c- o>==</c-> <c- mi>1</c-><c- p>)</c-> <c- p>{</c->
  <c- nl>x</c-> <c- p>:</c-><c- o>=</c-> <c- mi>1</c->
<c- p>}</c->
</pre>
   <p><img alt="Load buffering with data dependencies" height="457" src="./tests/lb+ctrldat+ctrl-single.png" width="425"></p>
   <p>Once again, the execution where <code class="highlight"><c- n>r1</c-> <c- o>==</c-> <c- mi>1</c-> <c- o>&amp;&amp;</c-> <c- n>r2</c-> <c- o>==</c-> <c- mi>1</c-></code> is allowed by the current standard, but it should not be. Again, it can be ruled out by forbidding cycles in dependency and <span class="rel rf">rf</span>.</p>
   <p>It is not enough to consider only the syntactic structure of the program when calculating dependencies. In the following test, a value loaded from memory is used in a conditional, but because a write of value <code class="highlight"><c- mi>1</c-></code> to <code class="highlight"><c- n>x</c-></code> occurs regardless, the compiler may optimise this conditional away.</p>
   <h3 class="heading settled" data-level="2.4" id="lb+false-deps"><span class="secno">2.4. </span><span class="content">Load buffering with false-dependency</span><a class="self-link" href="#lb+false-deps"></a></h3>
<pre class="language-c++ highlight"><c- c1>// Init:</c->
<c- nl>x</c-> <c- p>:</c-><c- o>=</c-> <c- mi>0</c-><c- p>;</c->
<c- nl>y</c-> <c- p>:</c-><c- o>=</c-> <c- mi>0</c-><c- p>;</c->

<c- c1>// Thread 0:</c->
<c- nl>r1</c-> <c- p>:</c-><c- o>=</c-> <c- n>x</c-><c- p>;</c->
<c- k>if</c-><c- p>(</c-><c- n>r1</c-> <c- o>==</c-> <c- mi>1</c-><c- p>)</c-> <c- p>{</c->
  <c- nl>y</c-> <c- p>:</c-><c- o>=</c-> <c- n>r1</c->
<c- p>}</c->

<c- c1>// Thread 1:</c->
<c- nl>r2</c-> <c- p>:</c-><c- o>=</c-> <c- n>y</c-><c- p>;</c->
<c- k>if</c-><c- p>(</c-><c- n>r2</c-> <c- o>==</c-> <c- mi>1</c-><c- p>)</c-> <c- p>{</c->
  <c- nl>x</c-> <c- p>:</c-><c- o>=</c-> <c- mi>1</c->
<c- p>}</c->
<c- k>else</c->
<c- p>{</c->
  <c- nl>x</c-> <c- p>:</c-><c- o>=</c-> <c- mi>1</c->
<c- p>}</c->
</pre>
   <p>The standard must allow the optimisation. Syntactic dependency, <span class="rel sdep">sdep</span>, is a relation that captures just the dependencies that should not be optimised away. In particular, there is no <span class="rel sdep">sdep</span> from the load of <code class="highlight"><c- n>y</c-></code> to the store of <code class="highlight"><c- n>x</c-></code> in this example. There is no cycle in <span class="rel sdep">sdep</span> and <span class="rel rf">rf</span>, so the following execution is allowed, as required. In all execution graphs the orange arrows represent <span class="rel sdep">sdep</span>.</p>
   <p><img alt="Load buffering with false-dependency" height="457" src="./tests/lbfd.png" width="425"></p>
   <h3 class="heading settled" data-level="2.5" id="hotspot"><span class="secno">2.5. </span><span class="content">Java Hotspot</span><a class="self-link" href="#hotspot"></a></h3>
   <p>While the audience for this paper is SG1, it is useful to consider other programming languages that have grappled with similar problems.
Java has a complex memory consistency model, and they too have had to consider what the meaning of dependency is in their programming language.
The following program <a data-link-type="biblio" href="#biblio-sevcik" title="Program Transformations in Weak Memory Models">[Sevcik]</a> is an example where the Java concurrency specification fails to allow all of Hotspot’s optimisations.</p>
<pre class="language-c++ highlight"><c- c1>// Init:</c->
<c- nl>x</c-> <c- p>:</c-><c- o>=</c-> <c- mi>0</c-><c- p>;</c->
<c- nl>y</c-> <c- p>:</c-><c- o>=</c-> <c- mi>0</c-><c- p>;</c->

<c- c1>// Thread 0:</c->
<c- nl>r1</c-> <c- p>:</c-><c- o>=</c-> <c- n>x</c-><c- p>;</c->
<c- nl>y</c-> <c- p>:</c-><c- o>=</c-> <c- n>r1</c->

<c- c1>// Thread 1:</c->
<c- nl>r2</c-> <c- p>:</c-><c- o>=</c-> <c- n>y</c-><c- p>;</c->
<c- k>if</c-><c- p>(</c-><c- n>r2</c-> <c- o>==</c-> <c- mi>1</c-><c- p>)</c-> <c- p>{</c->
  <c- nl>r3</c-> <c- p>:</c-><c- o>=</c-> <c- n>y</c-><c- p>;</c->
  <c- nl>x</c-> <c- p>:</c-><c- o>=</c-> <c- n>r3</c->
<c- p>}</c->
<c- k>else</c->
<c- p>{</c->
  <c- nl>x</c-> <c- p>:</c-><c- o>=</c-> <c- mi>1</c->
<c- p>}</c->
</pre>
   <p>Hotspot will optimise Thread 1 as follows: the load of <code class="highlight"><c- n>y</c-></code> in the true branch can take its value from the prior load of <code class="highlight"><c- n>y</c-></code>; in the true branch, that load must be of value <code class="highlight"><c- mi>1</c-></code>; the true branch now performs a concrete write of <code class="highlight"><c- mi>1</c-></code> to <code class="highlight"><c- n>x</c-></code>, just as the false branch does, so there is no need for the conditional; Thread 1 simply loads <code class="highlight"><c- n>y</c-></code> into <code class="highlight"><c- n>r2</c-></code> and <code class="highlight"><c- n>r3</c-></code> and writes <code class="highlight"><c- mi>1</c-></code> to <code class="highlight"><c- n>x</c-></code>. Now the optimised program can produce the outcome <code class="highlight"><c- n>r1</c-> <c- o>==</c-> <c- mi>1</c-> <c- o>&amp;&amp;</c-> <c- n>r2</c-> <c- o>==</c-> <c- mi>1</c-></code> on architectures that exhibit relaxed behaviour in the LB test.</p>
   <p>Rather than describe the list of optisations that is performed, <span class="rel sdep">sdep</span> is more abstract, describing the dependencies left in each excecution after optimisation. The optimisations described above impact the execution below, where both loads of <code class="highlight"><c- n>y</c-></code> on Thread 1 read from the write of value <code class="highlight"><c- mi>1</c-></code> on Thread 0. There is no semantic dependency from the load of <code class="highlight"><c- n>x</c-></code> to the write of <code class="highlight"><c- n>y</c-></code> because the series of optimisations performed by Hotspot can remove it. The exectuion with outcome <code class="highlight"><c- n>r1</c-> <c- o>==</c-> <c- mi>1</c-> <c- o>&amp;&amp;</c-> <c- n>r2</c-> <c- o>==</c-> <c- mi>1</c-></code> is then allowed because there is no cycle in <span class="rel sdep">sdep</span> and <span class="rel rf">rf</span>.</p>
   <p><img alt="Java hotspot example" height="575" src="./tests/hotspot.png" width="433"></p>
   <h3 class="heading settled" data-level="2.6" id="jctc18"><span class="secno">2.6. </span><span class="content">Java Causality Test Case 18</span><a class="self-link" href="#jctc18"></a></h3>
   <p>There is an established set of litmus tests for Java that analyses the effects of dependencies on the memory consistency model, called the <em>Java Causality Tests</em>. Test case 18 highlights the impact of global value-range analysis.</p>
<pre class="language-c++ highlight"><c- c1>// Init:</c->
<c- nl>x</c-> <c- p>:</c-><c- o>=</c-> <c- mi>0</c-><c- p>;</c->
<c- nl>y</c-> <c- p>:</c-><c- o>=</c-> <c- mi>0</c-><c- p>;</c->

<c- c1>// Thread 0:</c->
<c- nl>r3</c-> <c- p>:</c-><c- o>=</c-> <c- n>x</c-><c- p>;</c->
<c- k>if</c-><c- p>(</c-><c- n>r3</c-> <c- o>==</c-> <c- mi>0</c-><c- p>)</c-> <c- p>{</c->
  <c- nl>x</c-> <c- p>:</c-><c- o>=</c-> <c- mi>42</c->
<c- p>};</c->
<c- nl>r1</c-> <c- p>:</c-><c- o>=</c-> <c- n>x</c-><c- p>;</c->
<c- nl>y</c-> <c- p>:</c-><c- o>=</c-> <c- n>r1</c->

<c- c1>// Thread 1:</c->
<c- nl>r2</c-> <c- p>:</c-><c- o>=</c-> <c- n>y</c-><c- p>;</c->
<c- nl>x</c-> <c- p>:</c-><c- o>=</c-> <c- n>r2</c->
</pre>
   <p>A global analysis could determine that the only writes to <code class="highlight"><c- n>x</c-></code> in this program are of values <code class="highlight"><c- mi>0</c-></code> and <code class="highlight"><c- mi>42</c-></code>. Then on Thread 0, either the inital load of <code class="highlight"><c- n>x</c-></code> sees value <code class="highlight"><c- mi>42</c-></code>, or the conditional write of <code class="highlight"><c- n>x</c-></code> sets it to <code class="highlight"><c- mi>42</c-></code>, and in any case, the value of <code class="highlight"><c- n>r1</c-></code> is the concrete value <code class="highlight"><c- mi>42</c-></code>. Global value range analysis causes the compiler break the <span class="rel sdep">sdep</span> between the loads of <code class="highlight"><c- n>x</c-></code> and the store of <code class="highlight"><c- n>y</c-></code>.</p>
   <p><img alt="JCTC18" height="575" src="./tests/jctc18.png" width="434"></p>
   <p>In the execution above, the absence of <span class="rel sdep">sdep</span> on Thread 0 means that there is no cycle in <span class="rel sdep">sdep</span> and <span class="rel rf">rf</span>, and the outcome where <code class="highlight"><c- n>r1</c-> <c- o>==</c-> <c- mi>42</c-> <c- o>&amp;&amp;</c-> <c- n>r2</c-> <c- o>==</c-> <c- mi>42</c-></code> is allowed.</p>
   <p>We believe this optimisation should be allowed. Does SG1 agree?</p>
   <hr>
   <p>These introductory tests show examples where <span class="rel sdep">sdep</span> should, and should not, be present, and higlight the existence of cases where we need to ask to be sure.
There are a selection of tests where this choice is less clear-cut and we are interested in SG1’s opinion, we will discuss these next.</p>
   <h2 class="heading settled" data-level="3" id="tea"><span class="secno">3. </span><span class="content">Controversial Tests</span><a class="self-link" href="#tea"></a></h2>
   <h3 class="heading settled" data-level="3.1" id="goldblatt"><span class="secno">3.1. </span><span class="content">Goldblatt alignment</span><a class="self-link" href="#goldblatt"></a></h3>
   <p>First, we will look at an example from previous discussions with SG1 committee members when looking at <a data-link-type="biblio" href="#biblio-p1780" title="Modular Relaxed Dependencies: A new approach to the Out-Of-Thin-Air Problem">[P1780]</a>.
David Goldblatt pointed out that the compiler may enforce additional constraints on the values used in a program, e.g. aligning objects, and then optimisation may take advantage of these constraints, as in the follwoing example.</p>
<pre class="highlight"><c- k>struct</c-> <c- nc>S</c-> <c- p>{</c->
  <c- b>float</c-> <c- n>vectorData</c-><c- p>[</c-><c- mi>8</c-><c- p>];</c->
<c- p>};</c->

<c- n>S</c-> <c- n>s0</c-><c- p>;</c->
<c- n>S</c-> <c- n>s1</c-><c- p>;</c->
<c- n>S</c-> <c- n>s2</c-><c- p>;</c->

<c- n>atomic</c-><c- o>&lt;</c-><c- n>S</c-><c- o>*></c-> <c- n>x</c-><c- p>{</c-><c- o>&amp;</c-><c- n>s0</c-><c- p>};</c->
<c- n>atomic</c-><c- o>&lt;</c-><c- n>S</c-><c- o>*></c-> <c- n>y</c-><c- p>{</c-><c- o>&amp;</c-><c- n>s1</c-><c- p>};</c->

<c- n>S</c-><c- o>*</c-> <c- n>r1</c-><c- p>;</c->
<c- n>S</c-><c- o>*</c-> <c- n>r2</c-><c- p>;</c->

<c- b>void</c-> <c- nf>t1</c-><c- p>()</c-> <c- p>{</c->
  <c- n>r1</c-> <c- o>=</c-> <c- n>x</c-><c- p>.</c-><c- n>load</c-><c- p>(</c-><c- n>rlx</c-><c- p>);</c->
  <c- k>if</c-> <c- p>((</c-><c- b>uintptr_t</c-><c- p>)</c-><c- n>r1</c-> <c- o>%</c-> <c- mi>32</c-> <c- o>==</c-> <c- mi>0</c-><c- p>)</c-> <c- p>{</c->
    <c- n>y</c-><c- p>.</c-><c- n>store</c-><c- p>(</c-><c- o>&amp;</c-><c- n>s2</c-><c- p>);</c->
  <c- p>}</c->
<c- p>}</c->

<c- b>void</c-> <c- nf>t2</c-><c- p>()</c-> <c- p>{</c->
  <c- n>r2</c-> <c- o>=</c-> <c- n>y</c-><c- p>.</c-><c- n>load</c-><c- p>(</c-><c- n>rlx</c-><c- p>);</c->
  <c- k>if</c-> <c- p>((</c-><c- b>uintptr_t</c-><c- p>)</c-><c- n>r2</c-> <c- o>%</c-> <c- mi>32</c-> <c- o>==</c-> <c- mi>0</c-><c- p>)</c-> <c- p>{</c->
    <c- n>x</c-><c- p>.</c-><c- n>store</c-><c- p>(</c-><c- o>&amp;</c-><c- n>s2</c-><c- p>);</c->
  <c- p>}</c->
<c- p>}</c->
</pre>
   <p>Here <code class="highlight"><c- n>t1</c-></code> and <code class="highlight"><c- n>t2</c-></code> are to be run concurrently. The compiler may have chosen to align all <code class="highlight"><c- n>S</c-></code> objects to 32 bytes.
With this constraint, the compiler can remove the conditions in <code class="highlight"><c- n>t1</c-></code> and <code class="highlight"><c- n>t2</c-></code>: pointers to S-objects will always be <code class="highlight"><c- n>mod</c-> <c- mi>32</c-></code>. Therefore, there must not be <span class="rel sdep">sdep</span> edges from the loads to the stores in <code class="highlight"><c- n>t1</c-></code> and <code class="highlight"><c- n>t2</c-></code>. If this optimisation is allowed, the behaviour allowed by the definition of concurrency is necessarily implementation defined.</p>
   <p>We believe compilers do create constraints on values like this, and then optimise in the context of these choices, so there can be no <span class="rel sdep">sdep</span>. Does the committee agree?</p>
   <h3 class="heading settled" data-level="3.2" id="rfub"><span class="secno">3.2. </span><span class="content">RFUB</span><a class="self-link" href="#rfub"></a></h3>
   <p>Continuing with examples from SG1 members, in <a data-link-type="biblio" href="#biblio-p1217r1" title="Out-of-thin-air, revisited, again">[P1217R1]</a> Hans Boehm has discussed programs that appear to read from untaken branches.</p>
<pre class="language-c++ highlight"><c- c1>// Init:</c->
<c- nl>x</c-> <c- p>:</c-><c- o>=</c-> <c- mi>0</c-><c- p>;</c->
<c- nl>y</c-> <c- p>:</c-><c- o>=</c-> <c- mi>0</c-><c- p>;</c->

<c- c1>// Thread 0:</c->
<c- nl>r1</c-> <c- p>:</c-><c- o>=</c-> <c- n>x</c-><c- p>;</c->
<c- nl>y</c-> <c- p>:</c-><c- o>=</c-> <c- n>r1</c->

<c- c1>// Thread 1:</c->
<c- nl>z</c-> <c- p>:</c-><c- o>=</c-> <c- mi>0</c-><c- p>;</c->
<c- nl>r2</c-> <c- p>:</c-><c- o>=</c-> <c- n>y</c-><c- p>;</c->
<c- k>if</c-><c- p>(</c->¬<c- n>r2</c-> <c- o>==</c-> <c- mi>42</c-><c- p>)</c-> <c- p>{</c->
  <c- nl>z</c-> <c- p>:</c-><c- o>=</c-> <c- mi>1</c-><c- p>;</c->
  <c- nl>r2</c-> <c- p>:</c-><c- o>=</c-> <c- mi>42</c->
<c- p>};</c->
<c- nl>x</c-> <c- p>:</c-><c- o>=</c-> <c- n>r2</c-><c- p>;</c->
<c- nl>r3</c-> <c- p>:</c-><c- o>=</c-> <c- n>z</c->
</pre>
   <p>In this program, for similar reasons to the Java Hotspot example, a compiler could reason that, no matter what, <code class="highlight"><c- n>x</c-></code> is assigned <code class="highlight"><c- mi>42</c-></code> at the end of Thread 1: if Thread 1 did not read <code class="highlight"><c- mi>42</c-></code> from <code class="highlight"><c- n>y</c-></code> into <code class="highlight"><c- n>r2</c-></code>, then in the conditional, it will set <code class="highlight"><c- n>r2</c-></code> to <code class="highlight"><c- mi>42</c-></code>. Optimisation would not remove the conditional entirely: the write of <code class="highlight"><c- mi>1</c-></code> to <code class="highlight"><c- n>z</c-></code> is still dependent on the value read from <code class="highlight"><c- n>y</c-></code>. Removing the dependency on <code class="highlight"><c- n>x</c-></code> yields executions where we observe a store of 42 to <code class="highlight"><c- n>x</c-></code>, but not the store of 1 to <code class="highlight"><c- n>z</c-></code>.</p>
   <p><img alt="Read from untaken branch" height="693" src="./tests/rfub.png" width="434"></p>
   <p>Does allowing this execution, and chosing this set of <span class="rel sdep">sdep</span> edges, match the intention of SG1?</p>
   <h3 class="heading settled" data-level="3.3" id="oota4"><span class="secno">3.3. </span><span class="content">OOTA4</span><a class="self-link" href="#oota4"></a></h3>
   <p>This example has an execution that is contentious among concurrent models of dependency <a data-link-type="biblio" href="#biblio-pwt" title="The leaky semicolon: compositional semantic dependencies for relaxed-memory concurrency">[PwT]</a>. The program has apparent data dependencies from <code class="highlight"><c- n>y</c-></code> to <code class="highlight"><c- n>x</c-></code> on Thread 0 and from <code class="highlight"><c- n>x</c-></code> to <code class="highlight"><c- n>y</c-></code> on Thread 2.</p>
<pre class="language-c++ highlight"><c- c1>// Init:</c->
<c- nl>x</c-> <c- p>:</c-><c- o>=</c-> <c- mi>0</c-><c- p>;</c->
<c- nl>y</c-> <c- p>:</c-><c- o>=</c-> <c- mi>0</c-><c- p>;</c->
<c- nl>z</c-> <c- p>:</c-><c- o>=</c-> <c- mi>0</c-><c- p>;</c->
<c- nl>b</c-> <c- p>:</c-><c- o>=</c-> <c- mi>0</c-><c- p>;</c->

<c- c1>// Thread 0:</c->
<c- nl>r2</c-> <c- p>:</c-><c- o>=</c-> <c- n>y</c-><c- p>;</c->
<c- nl>r3</c-> <c- p>:</c-><c- o>=</c-> <c- n>b</c-><c- p>;</c->
<c- k>if</c-><c- p>(</c->¬<c- n>r3</c-> <c- o>==</c-> <c- mi>0</c-><c- p>)</c-> <c- p>{</c->
  <c- nl>x</c-> <c- p>:</c-><c- o>=</c-> <c- n>r2</c-><c- p>;</c->
  <c- nl>z</c-> <c- p>:</c-><c- o>=</c-> <c- n>r2</c->
<c- p>}</c->
<c- k>else</c->
<c- p>{</c->
  <c- nl>x</c-> <c- p>:</c-><c- o>=</c-> <c- mi>1</c->
<c- p>}</c->

<c- c1>// Thread 1:</c->
<c- nl>b</c-> <c- p>:</c-><c- o>=</c-> <c- mi>1</c->

<c- c1>// Thread 2:</c->
<c- nl>r1</c-> <c- p>:</c-><c- o>=</c-> <c- n>x</c-><c- p>;</c->
<c- nl>y</c-> <c- p>:</c-><c- o>=</c-> <c- n>r1</c->
</pre>
   <p>In the following execution, the <span class="rel rf">rf</span> edges over <code class="highlight"><c- n>x</c-></code> and <code class="highlight"><c- n>y</c-></code> form a cycle if data dependencies are recognised as <span class="rel sdep">sdep</span> edges. In this execution, <code class="highlight"><c- n>b</c-></code> reads from the write on Thread 1. We believe that these <span class="rel sdep">sdep</span> edges are correct and the execution should be forbidden.</p>
   <p><img alt="OOTA4 forbidden outcome" height="929" src="./tests/oota4.png" width="628"></p>
   <p>The explanation of why this might be reasonable is rather different to the workings of the C++ concurrency model. It hinges on changing the write that the read on Thread 2 gets its value from, from the <code class="highlight"><c- k>else</c-></code> branch on Thread 0 to the true branch. In this pattern of reasoning, we note that the read of <code class="highlight"><c- n>b</c-></code> on Thread 0 could read <code class="highlight"><c- mi>0</c-></code> from the initalisation, leading to the <code class="highlight"><c- k>else</c-></code> branch and a write of <code class="highlight"><c- mi>1</c-></code> to <code class="highlight"><c- n>x</c-></code>. Then Thread 2 can read <code class="highlight"><c- mi>1</c-></code> from <code class="highlight"><c- n>x</c-></code> and write <code class="highlight"><c- mi>1</c-></code> to <code class="highlight"><c- n>y</c-></code>. Now we reconsider the execution of Thread 0, changing the read of <code class="highlight"><c- n>b</c-></code> so that it reads <code class="highlight"><c- mi>1</c-></code> from Thread 1. Correspondingly, we change the control flow of Thread 0 so that it follows the true branch and writes <code class="highlight"><c- mi>1</c-></code> to <code class="highlight"><c- n>x</c-></code> and <code class="highlight"><c- n>z</c-></code>, allowing the execution above.</p>
   <p>We do not have a sequence of optimisations that leads to this behaviour, we believe this execution should be forbidden, and the <span class="rel sdep">sdep</span> edges should be as shown above. Does SG1 agree?</p>
   <h3 class="heading settled" data-level="3.4" id="cohcyc"><span class="secno">3.4. </span><span class="content">CohCYC</span><a class="self-link" href="#cohcyc"></a></h3>
   <p>This example also has an execution that is contentious among concurrent models of dependency <a data-link-type="biblio" href="#biblio-weakestmo" title="Grounding thin-air reads with event structures">[WeakestMO]</a>. The program has apparent control dependencies from <code class="highlight"><c- n>x</c-></code> to <code class="highlight"><c- n>y</c-></code> on Thread 0 and from <code class="highlight"><c- n>y</c-></code> to <code class="highlight"><c- n>x</c-></code> on Thread 1.</p>
<pre class="language-c++ highlight"><c- c1>// Init:</c->
<c- nl>x</c-> <c- p>:</c-><c- o>=</c-> <c- mi>0</c-><c- p>;</c->
<c- nl>y</c-> <c- p>:</c-><c- o>=</c-> <c- mi>0</c-><c- p>;</c->

<c- c1>// Thread 0:</c->
<c- nl>x</c-> <c- p>:</c-><c- o>=</c-> <c- mi>2</c-><c- p>;</c->
<c- nl>r1</c-> <c- p>:</c-><c- o>=</c-> <c- n>x</c-><c- p>;</c->
<c- k>if</c-><c- p>(</c->¬<c- n>r1</c-> <c- o>==</c-> <c- mi>2</c-><c- p>)</c-> <c- p>{</c->
  <c- nl>y</c-> <c- p>:</c-><c- o>=</c-> <c- mi>1</c->
<c- p>}</c->

<c- c1>// Thread 1:</c->
<c- nl>x</c-> <c- p>:</c-><c- o>=</c-> <c- mi>1</c-><c- p>;</c->
<c- nl>r2</c-> <c- p>:</c-><c- o>=</c-> <c- n>x</c-><c- p>;</c->
<c- nl>r3</c-> <c- p>:</c-><c- o>=</c-> <c- n>y</c-><c- p>;</c->
<c- k>if</c-><c- p>(</c->¬<c- n>r3</c-> <c- o>==</c-> <c- mi>0</c-><c- p>)</c-> <c- p>{</c->
  <c- nl>x</c-> <c- p>:</c-><c- o>=</c-> <c- mi>3</c->
<c- p>}</c->
</pre>
   <p>In the execution of concern, Thread 1 reads the value <code class="highlight"><c- mi>2</c-></code> from <code class="highlight"><c- n>x</c-></code>, and then follows a typical control-dependent load from <code class="highlight"><c- n>y</c-></code> and store to <code class="highlight"><c- n>x</c-></code>. The explanation of why this might be reasonable hinges on changing the write that satisfies the condition on Thread 0. Thread 0 will write <code class="highlight"><c- mi>1</c-></code> to <code class="highlight"><c- n>y</c-></code> if it reads <code class="highlight"><c- mi>1</c-></code> from <code class="highlight"><c- n>x</c-></code> on Thread 1. Then, if we read <code class="highlight"><c- mi>1</c-></code> from <code class="highlight"><c- n>y</c-></code> on Thread 1, <code class="highlight"><c- mi>3</c-></code> will be written to <code class="highlight"><c- n>x</c-></code>. Now, so the reasoning goes, reading <code class="highlight"><c- mi>3</c-></code> from <code class="highlight"><c- n>x</c-></code> on Thread 0 will also satisfy the conditional and lead to the write of <code class="highlight"><c- n>y</c-></code>, so we can swap to reading from the write of <code class="highlight"><c- mi>3</c-></code> to <code class="highlight"><c- n>x</c-></code>.</p>
   <p>We do not have a sequence of optimisations that leads to this behaviour, we believe this execution should be forbidden, and the <span class="rel sdep">sdep</span> edges should be as shown above. Does SG1 agree?</p>
   <p><img alt="Coh-CYC forbidden outcome" height="693" src="./tests/coh-cyc.png" width="433"></p>
   <h3 class="heading settled" data-level="3.5" id="freeze"><span class="secno">3.5. </span><span class="content">Freeze Example</span><a class="self-link" href="#freeze"></a></h3>
   <p>The most tricky example program and optimisation sequence we have is from Ori Lahav and Chung-Kil Hur.</p>
<pre class="language-c++ highlight"><c- c1>// Init:</c->
<c- nl>k</c-> <c- p>:</c-><c- o>=</c-> <c- mi>0</c-><c- p>;</c->
<c- nl>x</c-> <c- p>:</c-><c- o>=</c-> <c- mi>0</c-><c- p>;</c->
<c- nl>y</c-> <c- p>:</c-><c- o>=</c-> <c- mi>0</c-><c- p>;</c->
<c- nl>z</c-> <c- p>:</c-><c- o>=</c-> <c- mi>0</c-><c- p>;</c->
<c- nl>boom</c-> <c- p>:</c-><c- o>=</c-> <c- mi>0</c-><c- p>;</c->

<c- c1>// Thread 0:</c->
<c- nl>r1</c-> <c- p>:</c-><c- o>=</c-> <c- n>z</c-><c- p>;</c->
<c- nl>x</c-> <c- p>:</c-><c- o>=</c-> <c- n>r1</c->

<c- c1>// Thread 1:</c->
<c- nl>r2</c-> <c- p>:</c-><c- o>=</c-> <c- n>k</c-><c- p>.</c-><c- n>load</c-><c- p>(</c-><c- n>acq</c-><c- p>);</c->
<c- k>if</c-><c- p>(</c-><c- n>r2</c-> <c- o>==</c-> <c- mi>42</c-><c- p>)</c-> <c- p>{</c->
  <c- nl>r3</c-> <c- p>:</c-><c- o>=</c-> <c- n>x</c-><c- p>;</c->
  <c- k>if</c-><c- p>(</c-><c- n>r3</c-> <c- o>==</c-> <c- mi>1</c-><c- p>)</c-> <c- p>{</c->
    <c- nl>z</c-> <c- p>:</c-><c- o>=</c-> <c- n>r3</c-><c- p>;</c->
    <c- nl>boom</c-> <c- p>:</c-><c- o>=</c-> <c- mi>1</c->
  <c- p>}</c-> <c- k>else</c-> <c- p>{</c->
    <c- nl>r4</c-> <c- p>:</c-><c- o>=</c-> <c- n>y</c-><c- p>.</c-><c- n>load</c-><c- p>(</c-><c- n>na</c-><c- p>);</c->
    <c- nl>z</c-> <c- p>:</c-><c- o>=</c-> <c- n>r4</c->
  <c- p>}</c->
<c- p>}</c->

<c- c1>// Thread 2:</c->
<c- n>y</c-><c- p>.</c-><c- n>store</c-><c- p>(</c-><c- mi>1</c-><c- p>,</c-> <c- n>na</c-><c- p>,</c-> <c- n>normal</c-><c- p>);</c->
<c- n>k</c-><c- p>.</c-><c- n>store</c-><c- p>(</c-><c- mi>42</c-><c- p>,</c-> <c- n>rel</c-><c- p>,</c-> <c- n>normal</c-><c- p>)</c->
</pre>
   <p>In this test, we could reason that an execution that stores <code class="highlight"><c- mi>1</c-></code> to <code class="highlight"><c- n>boom</c-></code> could be allowed.
This depends on the <span class="rel sdep">sdep</span> edges that we apply in the following execution. Note, we include enough <span class="rel sdep">sdep</span> edges here to forbid the behaviour. We will go on to discuss a series of optimisations that may or may not be reasonable. If the optimisation sequence is reasonable, it would lead to removing one of the <span class="rel sdep">sdep</span> edges and allowing the behaviour.</p>
   <p>The optimisation sequence hinges on the use of a new <code class="highlight"><c- n>freeze</c-></code> operation in LLVMIR that allows the compiler to make assumptions about the values read by non-atomics. Use of <code class="highlight"><c- n>freeze</c-></code> can produce LLVM <em>poison values</em>, whose values are inteterminate, and can lead to undefined behaviours. We would like the SG1 opinion on the <code class="highlight"><c- n>freeze</c-></code> optimisation.</p>
   <p><img alt="Lahav et al" height="1047" src="./tests/ori.png" width="711"></p>
   <p>The cycle in <span class="rel sdep">sdep</span> and <span class="rel rf">rf</span> that forbids this outcome is over events <code class="highlight"><c- mi>16</c-></code>, <code class="highlight"><c- mi>17</c-></code>, <code class="highlight"><c- mi>28</c-></code> and <code class="highlight"><c- mi>29</c-></code>. The question is whether there should be an <span class="rel sdep">sdep</span> edge from event <code class="highlight"><c- mi>16</c-></code> to event <code class="highlight"><c- mi>17</c-></code>: from the load of <code class="highlight"><c- n>x</c-></code> to the store of <code class="highlight"><c- n>z</c-></code> on Thread 1.</p>
   <p>The series of optimisations that might remove that <span class="rel sdep">sdep</span> edge and permit this behaviour relies on  global analysis. The optimisations are all on Thread 1, and we repeat the transformed program after each step. To start with, Thread 1 is as follows.</p>
<pre class="language-c++ highlight"><c- c1>// Thread 1:</c->
<c- nl>r2</c-> <c- p>:</c-><c- o>=</c-> <c- n>k</c-><c- p>.</c-><c- n>load</c-><c- p>(</c-><c- n>acq</c-><c- p>);</c->
<c- k>if</c-><c- p>(</c-><c- n>r2</c-> <c- o>==</c-> <c- mi>42</c-><c- p>)</c-> <c- p>{</c->
  <c- nl>r3</c-> <c- p>:</c-><c- o>=</c-> <c- n>x</c-><c- p>;</c->
  <c- k>if</c-><c- p>(</c-><c- n>r3</c-> <c- o>==</c-> <c- mi>1</c-><c- p>)</c-> <c- p>{</c->
    <c- nl>z</c-> <c- p>:</c-><c- o>=</c-> <c- n>r3</c-><c- p>;</c->
    <c- nl>boom</c-> <c- p>:</c-><c- o>=</c-> <c- mi>1</c->
  <c- p>}</c-> <c- k>else</c-> <c- p>{</c->
    <c- nl>r4</c-> <c- p>:</c-><c- o>=</c-> <c- n>y</c-><c- p>.</c-><c- n>load</c-><c- p>(</c-><c- n>na</c-><c- p>);</c->
    <c- nl>z</c-> <c- p>:</c-><c- o>=</c-> <c- n>r4</c->
  <c- p>}</c->
<c- p>}</c->
</pre>
   <p><strong>Load introduction</strong></p>
   <p>We introduce a non-atomic load of <code class="highlight"><c- n>y</c-></code> into <code class="highlight"><c- n>r5</c-></code>. This step relies on global knowledge: introducing a non-atomic in the general case may introduce a race, but here a global analysis could infer that the only other access of <code class="highlight"><c- n>y</c-></code>, on Thread 2, is not racy because the <code class="highlight"><c- k>if</c-></code> on Thread 1 guards against it, ensuring <span class="rel hb">happens-before</span> if the read is run.</p>
<pre class="language-c++ highlight"><c- c1>// Thread 1:</c->
<c- nl>r2</c-> <c- p>:</c-><c- o>=</c-> <c- n>k</c-><c- p>.</c-><c- n>load</c-><c- p>(</c-><c- n>acq</c-><c- p>);</c->
<c- k>if</c-><c- p>(</c-><c- n>r2</c-> <c- o>==</c-> <c- mi>42</c-><c- p>)</c-> <c- p>{</c->
  <c- nl>r5</c-> <c- p>:</c-><c- o>=</c-> <c- n>y</c-><c- p>.</c-><c- n>load</c-><c- p>(</c-><c- n>na</c-><c- p>);</c->
  <c- nl>r3</c-> <c- p>:</c-><c- o>=</c-> <c- n>x</c-><c- p>;</c->
  <c- k>if</c-><c- p>(</c-><c- n>r3</c-> <c- o>==</c-> <c- mi>1</c-><c- p>)</c-> <c- p>{</c->
    <c- nl>z</c-> <c- p>:</c-><c- o>=</c-> <c- n>r3</c-><c- p>;</c->
    <c- nl>boom</c-> <c- p>:</c-><c- o>=</c-> <c- mi>1</c->
  <c- p>}</c-> <c- k>else</c-> <c- p>{</c->
    <c- nl>r4</c-> <c- p>:</c-><c- o>=</c-> <c- n>y</c-><c- p>.</c-><c- n>load</c-><c- p>(</c-><c- n>na</c-><c- p>);</c->
    <c- nl>z</c-> <c- p>:</c-><c- o>=</c-> <c- n>r4</c->
  <c- p>}</c->
<c- p>}</c->
</pre>
   <p><strong>Load forwarding</strong></p>
   <p>We replace the non-atomic load of <code class="highlight"><c- n>y</c-></code> in the <code class="highlight"><c- k>else</c-></code> branch with <code class="highlight"><c- n>r5</c-></code> from our introduced non-atomic load.</p>
<pre class="language-c++ highlight"><c- c1>// Thread 1:</c->
<c- nl>r2</c-> <c- p>:</c-><c- o>=</c-> <c- n>k</c-><c- p>.</c-><c- n>load</c-><c- p>(</c-><c- n>acq</c-><c- p>);</c->
<c- k>if</c-><c- p>(</c-><c- n>r2</c-> <c- o>==</c-> <c- mi>42</c-><c- p>)</c-> <c- p>{</c->
  <c- nl>r5</c-> <c- p>:</c-><c- o>=</c-> <c- n>y</c-><c- p>.</c-><c- n>load</c-><c- p>(</c-><c- n>na</c-><c- p>);</c->
  <c- nl>r3</c-> <c- p>:</c-><c- o>=</c-> <c- n>x</c-><c- p>;</c->
  <c- k>if</c-><c- p>(</c-><c- n>r3</c-> <c- o>==</c-> <c- mi>1</c-><c- p>)</c-> <c- p>{</c->
    <c- nl>z</c-> <c- p>:</c-><c- o>=</c-> <c- n>r3</c-><c- p>;</c->
    <c- nl>boom</c-> <c- p>:</c-><c- o>=</c-> <c- mi>1</c->
  <c- p>}</c-> <c- k>else</c-> <c- p>{</c->
    <c- nl>r4</c-> <c- p>:</c-><c- o>=</c-> <c- n>r5</c-><c- p>;</c-> <c- c1>// load forward</c->
    <c- nl>z</c-> <c- p>:</c-><c- o>=</c-> <c- n>r4</c->
  <c- p>}</c->
<c- p>}</c->
</pre>
   <p><strong>LLVM trace preserving transformation</strong></p>
   <p>We <code class="highlight"><c- n>freeze</c-></code> the non-atomic load of <code class="highlight"><c- n>y</c-></code> at value <code class="highlight"><c- mi>1</c-></code>. This adds a branch on <code class="highlight"><c- n>freeze</c-><c- p>(</c-><c- n>r5</c-><c- o>==</c-><c- mi>1</c-><c- p>)</c-></code>. In the true case of the branch, the compiler can optimise with the knowledge that <code class="highlight"><c- n>r5</c-><c- o>==</c-><c- mi>1</c-></code>, but in the else branch, <code class="highlight"><c- n>r5</c-></code> carries a poison value that may lead to undefined behaviour.</p>
<pre class="language-c++ highlight"><c- c1>// Thread 1:</c->
<c- nl>r2</c-> <c- p>:</c-><c- o>=</c-> <c- n>k</c-><c- p>.</c-><c- n>load</c-><c- p>(</c-><c- n>acq</c-><c- p>);</c->
<c- k>if</c-><c- p>(</c-><c- n>r2</c-> <c- o>==</c-> <c- mi>42</c-><c- p>)</c-> <c- p>{</c->
  <c- nl>r5</c-> <c- p>:</c-><c- o>=</c-> <c- n>y</c-><c- p>.</c-><c- n>load</c-><c- p>(</c-><c- n>na</c-><c- p>);</c->
  <c- k>if</c-> <c- p>(</c-><c- n>freeze</c-><c- p>(</c-><c- n>r5</c-><c- o>==</c-><c- mi>1</c-><c- p>))</c-> <c- p>{</c-> <c- c1>// freeze</c->
    <c- nl>r3</c-> <c- p>:</c-><c- o>=</c-> <c- n>x</c-><c- p>;</c->
    <c- k>if</c-><c- p>(</c-><c- n>r3</c-> <c- o>==</c-> <c- mi>1</c-><c- p>)</c-> <c- p>{</c->
      <c- nl>z</c-> <c- p>:</c-><c- o>=</c-> <c- n>r3</c-><c- p>;</c->
      <c- nl>boom</c-> <c- p>:</c-><c- o>=</c-> <c- mi>1</c->
    <c- p>}</c-> <c- k>else</c-> <c- p>{</c->
      <c- nl>r4</c-> <c- p>:</c-><c- o>=</c-> <c- n>r5</c-><c- p>;</c->
      <c- nl>z</c-> <c- p>:</c-><c- o>=</c-> <c- n>r4</c->
    <c- p>}</c->
  <c- p>}</c-> <c- k>else</c-> <c- p>{</c->
    <c- d>/* ... */</c->
  <c- p>}</c->
<c- p>}</c->
</pre>
   <p><strong>LLVM trace preserving transformation</strong></p>
   <p>We simplify terms using the predicates on branches.</p>
<pre class="language-c++ highlight"><c- c1>// Thread 1:</c->
<c- nl>r2</c-> <c- p>:</c-><c- o>=</c-> <c- n>k</c-><c- p>.</c-><c- n>load</c-><c- p>(</c-><c- n>acq</c-><c- p>);</c->
<c- k>if</c-><c- p>(</c-><c- n>r2</c-> <c- o>==</c-> <c- mi>42</c-><c- p>)</c-> <c- p>{</c->
  <c- nl>r5</c-> <c- p>:</c-><c- o>=</c-> <c- n>y</c-><c- p>.</c-><c- n>load</c-><c- p>(</c-><c- n>na</c-><c- p>);</c->
  <c- k>if</c-> <c- p>(</c-><c- n>freeze</c-><c- p>(</c-><c- n>c</c-><c- o>==</c-><c- mi>1</c-><c- p>))</c-> <c- p>{</c->
    <c- nl>r3</c-> <c- p>:</c-><c- o>=</c-> <c- n>x</c-><c- p>;</c->
    <c- k>if</c-><c- p>(</c-><c- n>r3</c-> <c- o>==</c-> <c- mi>1</c-><c- p>)</c-> <c- p>{</c->
      <c- nl>z</c-> <c- p>:</c-><c- o>=</c-> <c- mi>1</c-><c- p>;</c-> <c- c1>// simplification r3 == 1</c->
      <c- nl>boom</c-> <c- p>:</c-><c- o>=</c-> <c- mi>1</c->
    <c- p>}</c-> <c- k>else</c-> <c- p>{</c->
      <c- nl>r4</c-> <c- p>:</c-><c- o>=</c-> <c- mi>1</c-><c- p>;</c-> <c- c1>// simplification using freeze(r5==1)</c->
      <c- nl>z</c-> <c- p>:</c-><c- o>=</c-> <c- n>r4</c->
    <c- p>}</c->
  <c- p>}</c-> <c- k>else</c-> <c- p>{</c->
    <c- d>/* ... */</c->
  <c- p>}</c->
<c- p>}</c->
</pre>
   <p><strong>LLVM trace preserving transformation</strong></p>
   <p>Here we constant propagate the register value into the store on <code class="highlight"><c- n>z</c-></code> and then hoist the <code class="highlight"><c- nl>z</c-> <c- p>:</c-><c- o>=</c-> <c- mi>1</c-></code> out of the conditional.
The <code class="highlight"><c- k>else</c-></code> branch is now empty.</p>
<pre class="language-c++ highlight"><c- c1>// Thread 1:</c->
<c- nl>r2</c-> <c- p>:</c-><c- o>=</c-> <c- n>k</c-><c- p>.</c-><c- n>load</c-><c- p>(</c-><c- n>acq</c-><c- p>);</c->
<c- k>if</c-><c- p>(</c-><c- n>r2</c-> <c- o>==</c-> <c- mi>42</c-><c- p>)</c-> <c- p>{</c->
  <c- nl>r5</c-> <c- p>:</c-><c- o>=</c-> <c- n>y</c-><c- p>.</c-><c- n>load</c-><c- p>(</c-><c- n>na</c-><c- p>);</c->
  <c- k>if</c-> <c- p>(</c-><c- n>freeze</c-><c- p>(</c-><c- n>c</c-><c- o>==</c-><c- mi>1</c-><c- p>))</c-> <c- p>{</c->
    <c- nl>r3</c-> <c- p>:</c-><c- o>=</c-> <c- n>x</c-><c- p>;</c->
    <c- nl>z</c-> <c- p>:</c-><c- o>=</c-> <c- mi>1</c-><c- p>;</c-> <c- c1>// hoisted</c->
    <c- k>if</c-><c- p>(</c-><c- n>r3</c-> <c- o>==</c-> <c- mi>1</c-><c- p>)</c-> <c- p>{</c->
      <c- nl>boom</c-> <c- p>:</c-><c- o>=</c-> <c- mi>1</c->
    <c- p>}</c->
    <c- k>else</c-> <c- p>{</c-> <c- p>}</c->
  <c- p>}</c-> <c- k>else</c-> <c- p>{</c->
    <c- d>/* ... */</c->
  <c- p>}</c->
<c- p>}</c->
</pre>
   <p>There is now no dependency between <code class="highlight"><c- nl>r3</c-> <c- p>:</c-><c- o>=</c-> <c- n>x</c-></code> and <code class="highlight"><c- nl>z</c-> <c- p>:</c-><c- o>=</c-> <c- mi>1</c-></code> so they can be hardware re-ordered.
In context with the rest of the program <code class="highlight"><c- n>r3</c-> <c- o>==</c-> <c- mi>1</c-></code> is now observable and the program can store <code class="highlight"><c- mi>1</c-></code> to <code class="highlight"><c- n>boom</c-></code>. This execution would be allowed if the <span class="rel sdep">sdep</span> edge were removed between events <code class="highlight"><c- mi>16</c-></code> and <code class="highlight"><c- mi>17</c-></code> in the execution above.</p>
   <p>Note that this execution is race-free, the non-atomic store is <span class="rel hb">happens-before</span> the load, thanks to the <code class="highlight"><c- n>release</c-></code>/<code class="highlight"><c- n>acquire</c-></code> pair on <code class="highlight"><c- n>k</c-></code>.</p>
   <p>Is SG1 happy with this set of transformations? Should this weak execution be allowed?</p>
   <h2 class="heading settled" data-level="4" id="jct"><span class="secno">4. </span><span class="content"><span class="rel sdep">sdep</span> in Java Causality Tests</span><a class="self-link" href="#jct"></a></h2>
   <p>To contextualise <span class="rel sdep">sdep</span> with the Java Causality Tests, we print the tests, the interesting execution, and our conclusion on acyclicity of <span class="rel sdep">sdep</span> and <span class="rel rf">rf</span>.
See <a data-link-type="biblio" href="#biblio-jct" title="Causality Test Cases">[JCT]</a>.</p>
   <h3 class="heading settled" data-level="4.1" id="jctc1"><span class="secno">4.1. </span><span class="content">JCTC1</span><a class="self-link" href="#jctc1"></a></h3>
<pre class="language-c++ highlight"><c- c1>// Init:</c->
<c- nl>x</c-> <c- p>:</c-><c- o>=</c-> <c- mi>0</c-><c- p>;</c->
<c- nl>y</c-> <c- p>:</c-><c- o>=</c-> <c- mi>0</c-><c- p>;</c->

<c- c1>// Thread 0:</c->
<c- nl>r1</c-> <c- p>:</c-><c- o>=</c-> <c- n>x</c-><c- p>;</c->
<c- k>if</c-><c- p>(</c-><c- n>r1</c-> <c- o>>=</c-> <c- mi>0</c-><c- p>)</c-> <c- p>{</c->
  <c- nl>y</c-> <c- p>:</c-><c- o>=</c-> <c- mi>1</c->
<c- p>}</c->

<c- c1>// Thread 1:</c->
<c- nl>r2</c-> <c- p>:</c-><c- o>=</c-> <c- n>y</c-><c- p>;</c->
<c- nl>x</c-> <c- p>:</c-><c- o>=</c-> <c- n>r2</c->
</pre>
   <p><img alt="JCTC1" height="457" src="./tests/jctc1.png" width="433"></p>
   <p>Allowed, no cycle. A compiler can observe that <code class="highlight"><c- n>x</c-></code> is always greater than or equal to zero.</p>
   <h3 class="heading settled" data-level="4.2" id="jctc2"><span class="secno">4.2. </span><span class="content">JCTC2</span><a class="self-link" href="#jctc2"></a></h3>
<pre class="language-c++ highlight"><c- c1>// Init:</c->
<c- nl>x</c-> <c- p>:</c-><c- o>=</c-> <c- mi>0</c-><c- p>;</c->
<c- nl>y</c-> <c- p>:</c-><c- o>=</c-> <c- mi>0</c-><c- p>;</c->

<c- c1>// Thread 0:</c->
<c- nl>r1</c-> <c- p>:</c-><c- o>=</c-> <c- n>x</c-><c- p>;</c->
<c- nl>r2</c-> <c- p>:</c-><c- o>=</c-> <c- n>x</c-><c- p>;</c->
<c- k>if</c-><c- p>(</c-><c- n>r1</c-> <c- o>==</c-> <c- n>r2</c-><c- p>)</c-> <c- p>{</c->
  <c- nl>y</c-> <c- p>:</c-><c- o>=</c-> <c- mi>1</c->
<c- p>}</c->

<c- c1>// Thread 1:</c->
<c- nl>r3</c-> <c- p>:</c-><c- o>=</c-> <c- n>y</c-><c- p>;</c->
<c- nl>x</c-> <c- p>:</c-><c- o>=</c-> <c- n>r3</c->
</pre>
   <p><img alt="JCTC2" height="575" src="./tests/jctc2.png" width="433"></p>
   <p>Allowed, no cycle. A compiler can assert that two relaxed loads to the same location will yield the same value.</p>
   <h3 class="heading settled" data-level="4.3" id="jctc3"><span class="secno">4.3. </span><span class="content">JCTC3</span><a class="self-link" href="#jctc3"></a></h3>
<pre class="language-c++ highlight"><c- c1>// Init:</c->
<c- nl>x</c-> <c- p>:</c-><c- o>=</c-> <c- mi>0</c-><c- p>;</c->
<c- nl>y</c-> <c- p>:</c-><c- o>=</c-> <c- mi>0</c-><c- p>;</c->

<c- c1>// Thread 0:</c->
<c- nl>x</c-> <c- p>:</c-><c- o>=</c-> <c- mi>2</c->

<c- c1>// Thread 1:</c->
<c- nl>r1</c-> <c- p>:</c-><c- o>=</c-> <c- n>x</c-><c- p>;</c->
<c- nl>r2</c-> <c- p>:</c-><c- o>=</c-> <c- n>x</c-><c- p>;</c->
<c- k>if</c-><c- p>(</c-><c- n>r1</c-> <c- o>==</c-> <c- n>r2</c-><c- p>)</c-> <c- p>{</c->
  <c- nl>y</c-> <c- p>:</c-><c- o>=</c-> <c- mi>1</c->
<c- p>}</c->

<c- c1>// Thread 2:</c->
<c- nl>r3</c-> <c- p>:</c-><c- o>=</c-> <c- n>y</c-><c- p>;</c->
<c- nl>x</c-> <c- p>:</c-><c- o>=</c-> <c- n>r3</c->
</pre>
   <p><img alt="JCTC3" height="575" src="./tests/jctc3.png" width="669"></p>
   <p>Allowed, no cycle. Similar to above.</p>
   <h3 class="heading settled" data-level="4.4" id="jctc4"><span class="secno">4.4. </span><span class="content">JCTC4</span><a class="self-link" href="#jctc4"></a></h3>
<pre class="language-c++ highlight"><c- c1>// Init:</c->
<c- nl>x</c-> <c- p>:</c-><c- o>=</c-> <c- mi>0</c-><c- p>;</c->
<c- nl>y</c-> <c- p>:</c-><c- o>=</c-> <c- mi>0</c-><c- p>;</c->

<c- c1>// Thread 0:</c->
<c- nl>r1</c-> <c- p>:</c-><c- o>=</c-> <c- n>x</c-><c- p>;</c->
<c- nl>y</c-> <c- p>:</c-><c- o>=</c-> <c- n>r1</c->

<c- c1>// Thread 1:</c->
<c- nl>r2</c-> <c- p>:</c-><c- o>=</c-> <c- n>y</c-><c- p>;</c->
<c- nl>x</c-> <c- p>:</c-><c- o>=</c-> <c- n>r2</c->
</pre>
   <p><img alt="JCTC4" height="457" src="./tests/jctc4.png" width="433"></p>
   <p>Forbidden, cycle in <span class="rel sdep">sdep</span> ∪ <span class="rel rf">rf</span>. No values from thin air.</p>
   <h3 class="heading settled" data-level="4.5" id="jctc5"><span class="secno">4.5. </span><span class="content">JCTC5</span><a class="self-link" href="#jctc5"></a></h3>
<pre class="language-c++ highlight"><c- c1>// Init:</c->
<c- nl>x</c-> <c- p>:</c-><c- o>=</c-> <c- mi>0</c-><c- p>;</c->
<c- nl>y</c-> <c- p>:</c-><c- o>=</c-> <c- mi>0</c-><c- p>;</c->
<c- nl>z</c-> <c- p>:</c-><c- o>=</c-> <c- mi>0</c-><c- p>;</c->

<c- c1>// Thread 0:</c->
<c- nl>z</c-> <c- p>:</c-><c- o>=</c-> <c- mi>1</c->

<c- c1>// Thread 1:</c->
<c- nl>r3</c-> <c- p>:</c-><c- o>=</c-> <c- n>z</c-><c- p>;</c->
<c- nl>x</c-> <c- p>:</c-><c- o>=</c-> <c- n>r3</c->

<c- c1>// Thread 2:</c->
<c- nl>r2</c-> <c- p>:</c-><c- o>=</c-> <c- n>y</c-><c- p>;</c->
<c- nl>x</c-> <c- p>:</c-><c- o>=</c-> <c- n>r2</c->

<c- c1>// Thread 3:</c->
<c- nl>r1</c-> <c- p>:</c-><c- o>=</c-> <c- n>x</c-><c- p>;</c->
<c- nl>y</c-> <c- p>:</c-><c- o>=</c-> <c- n>r1</c->
</pre>
   <p><img alt="JCTC5" height="575" src="./tests/jctc5.png" width="947"></p>
   <p>Forbidden, cycle in <span class="rel sdep">sdep</span> ∪ <span class="rel rf">rf</span>. No values from thin air.</p>
   <h3 class="heading settled" data-level="4.6" id="jctc6"><span class="secno">4.6. </span><span class="content">JCTC6</span><a class="self-link" href="#jctc6"></a></h3>
<pre class="language-c++ highlight"><c- c1>// Init:</c->
<c- nl>A</c-> <c- p>:</c-><c- o>=</c-> <c- mi>0</c-><c- p>;</c->
<c- nl>B</c-> <c- p>:</c-><c- o>=</c-> <c- mi>0</c-><c- p>;</c->

<c- c1>// Thread 0:</c->
<c- nl>r1</c-> <c- p>:</c-><c- o>=</c-> <c- n>A</c-><c- p>;</c->
<c- k>if</c-><c- p>(</c-><c- n>r1</c-> <c- o>==</c-> <c- mi>1</c-><c- p>)</c-> <c- p>{</c->
  <c- nl>B</c-> <c- p>:</c-><c- o>=</c-> <c- mi>1</c->
<c- p>}</c->

<c- c1>// Thread 1:</c->
<c- nl>r2</c-> <c- p>:</c-><c- o>=</c-> <c- n>B</c-><c- p>;</c->
<c- k>if</c-><c- p>(</c-><c- n>r2</c-> <c- o>==</c-> <c- mi>1</c-><c- p>)</c-> <c- p>{</c->
  <c- nl>A</c-> <c- p>:</c-><c- o>=</c-> <c- mi>1</c->
<c- p>};</c->
<c- k>if</c-><c- p>(</c-><c- n>r2</c-> <c- o>==</c-> <c- mi>0</c-><c- p>)</c-> <c- p>{</c->
  <c- nl>A</c-> <c- p>:</c-><c- o>=</c-> <c- mi>1</c->
<c- p>}</c->
</pre>
   <p><img alt="JCTC6" height="457" src="./tests/jctc6.png" width="425"></p>
   <p>Allowed, no cycle. A compiler can observe that the <code class="highlight"><c- k>if</c-></code> cases cover all possible values of <code class="highlight"><c- n>B</c-></code> in this program, so there is always a store of <code class="highlight"><c- mi>1</c-></code> to <code class="highlight"><c- n>A</c-></code>.</p>
   <h3 class="heading settled" data-level="4.7" id="jctc7"><span class="secno">4.7. </span><span class="content">JCTC7</span><a class="self-link" href="#jctc7"></a></h3>
<pre class="language-c++ highlight"><c- c1>// Init:</c->
<c- nl>x</c-> <c- p>:</c-><c- o>=</c-> <c- mi>0</c-><c- p>;</c->
<c- nl>y</c-> <c- p>:</c-><c- o>=</c-> <c- mi>0</c-><c- p>;</c->
<c- nl>z</c-> <c- p>:</c-><c- o>=</c-> <c- mi>0</c-><c- p>;</c->

<c- c1>// Thread 0:</c->
<c- nl>r1</c-> <c- p>:</c-><c- o>=</c-> <c- n>z</c-><c- p>;</c->
<c- nl>r2</c-> <c- p>:</c-><c- o>=</c-> <c- n>x</c-><c- p>;</c->
<c- nl>y</c-> <c- p>:</c-><c- o>=</c-> <c- n>r2</c->

<c- c1>// Thread 1:</c->
<c- nl>r3</c-> <c- p>:</c-><c- o>=</c-> <c- n>y</c-><c- p>;</c->
<c- nl>z</c-> <c- p>:</c-><c- o>=</c-> <c- n>r3</c-><c- p>;</c->
<c- nl>x</c-> <c- p>:</c-><c- o>=</c-> <c- mi>1</c->
</pre>
   <p><img alt="JCTC7" height="693" src="./tests/jctc7.png" width="433"></p>
   <p>Allowed, no cycle. Hardware and compiler reordering makes this observable.</p>
   <h3 class="heading settled" data-level="4.8" id="jctc8"><span class="secno">4.8. </span><span class="content">JCTC8</span><a class="self-link" href="#jctc8"></a></h3>
<pre class="language-c++ highlight"><c- c1>// Init:</c->
<c- nl>x</c-> <c- p>:</c-><c- o>=</c-> <c- mi>0</c-><c- p>;</c->
<c- nl>y</c-> <c- p>:</c-><c- o>=</c-> <c- mi>0</c-><c- p>;</c->

<c- c1>// Thread 0:</c->
<c- nl>r1</c-> <c- p>:</c-><c- o>=</c-> <c- n>x</c-><c- p>;</c->
<c- nl>r2</c-> <c- p>:</c-><c- o>=</c-> <c- p>(</c-><c- mi>1</c-> <c- o>+</c-> <c- p>(</c-><c- n>r1</c-> <c- o>*</c-> <c- n>r1</c-> <c- o>-</c-> <c- n>r1</c-><c- p>));</c->
<c- nl>y</c-> <c- p>:</c-><c- o>=</c-> <c- n>r2</c->

<c- c1>// Thread 1:</c->
<c- nl>r3</c-> <c- p>:</c-><c- o>=</c-> <c- n>y</c-><c- p>;</c->
<c- nl>x</c-> <c- p>:</c-><c- o>=</c-> <c- n>r3</c->
</pre>
   <p><img alt="JCTC8" height="457" src="./tests/jctc8.png" width="433"></p>
   <p>Allowed, no cycle.</p>
   <blockquote>
    <p>Interthread analysis could determine that x and y are always
either 0 or 1, and thus determine that r2 is always 1. Once this determination
is made, the write of 1 to y could be moved early in thread 1.</p>
   </blockquote>
   <h3 class="heading settled" data-level="4.9" id="jctc9"><span class="secno">4.9. </span><span class="content">JCTC9</span><a class="self-link" href="#jctc9"></a></h3>
<pre class="language-c++ highlight"><c- c1>// Init:</c->
<c- nl>x</c-> <c- p>:</c-><c- o>=</c-> <c- mi>0</c-><c- p>;</c->
<c- nl>y</c-> <c- p>:</c-><c- o>=</c-> <c- mi>0</c-><c- p>;</c->

<c- c1>// Thread 0:</c->
<c- nl>x</c-> <c- p>:</c-><c- o>=</c-> <c- mi>2</c->

<c- c1>// Thread 1:</c->
<c- nl>r1</c-> <c- p>:</c-><c- o>=</c-> <c- n>x</c-><c- p>;</c->
<c- nl>y</c-> <c- p>:</c-><c- o>=</c-> <c- p>(</c-><c- mi>1</c-> <c- o>+</c-> <c- p>(</c-><c- n>r1</c-> <c- o>*</c-> <c- n>r1</c-> <c- o>-</c-> <c- n>r1</c-><c- p>))</c->

<c- c1>// Thread 2:</c->
<c- nl>r3</c-> <c- p>:</c-><c- o>=</c-> <c- n>y</c-><c- p>;</c->
<c- nl>x</c-> <c- p>:</c-><c- o>=</c-> <c- n>r3</c->
</pre>
   <p><img alt="JCTC9" height="457" src="./tests/jctc9.png" width="669"></p>
   <p>Allowed, no cycle.</p>
   <blockquote>
    <p>Allowed. Similar to test case 8, except that the x is not always
0 or 1. However, a compiler might determine that the read of x by thread
2 will never see the write by thread 3 (perhaps because thread 3
will be scheduled after thread 1).  Thus, the compiler
can determine that r1 will always be 0 or 1.</p>
   </blockquote>
   <h3 class="heading settled" data-level="4.10" id="jctc10"><span class="secno">4.10. </span><span class="content">JCTC10</span><a class="self-link" href="#jctc10"></a></h3>
<pre class="language-c++ highlight"><c- c1>// Init:</c->
<c- nl>x</c-> <c- p>:</c-><c- o>=</c-> <c- mi>0</c-><c- p>;</c->
<c- nl>y</c-> <c- p>:</c-><c- o>=</c-> <c- mi>0</c-><c- p>;</c->
<c- nl>z</c-> <c- p>:</c-><c- o>=</c-> <c- mi>0</c-><c- p>;</c->

<c- c1>// Thread 0:</c->
<c- nl>r3</c-> <c- p>:</c-><c- o>=</c-> <c- n>z</c-><c- p>;</c->
<c- k>if</c-><c- p>(</c-><c- n>r3</c-> <c- o>==</c-> <c- mi>1</c-><c- p>)</c-> <c- p>{</c->
  <c- nl>x</c-> <c- p>:</c-><c- o>=</c-> <c- mi>1</c->
<c- p>}</c->

<c- c1>// Thread 1:</c->
<c- nl>r2</c-> <c- p>:</c-><c- o>=</c-> <c- n>y</c-><c- p>;</c->
<c- k>if</c-><c- p>(</c-><c- n>r2</c-> <c- o>==</c-> <c- mi>1</c-><c- p>)</c-> <c- p>{</c->
  <c- nl>x</c-> <c- p>:</c-><c- o>=</c-> <c- mi>1</c->
<c- p>}</c->

<c- c1>// Thread 2:</c->
<c- nl>z</c-> <c- p>:</c-><c- o>=</c-> <c- mi>1</c->

<c- c1>// Thread 3:</c->
<c- nl>r1</c-> <c- p>:</c-><c- o>=</c-> <c- n>x</c-><c- p>;</c->
<c- k>if</c-><c- p>(</c-><c- n>r1</c-> <c- o>==</c-> <c- mi>1</c-><c- p>)</c-> <c- p>{</c->
  <c- nl>y</c-> <c- p>:</c-><c- o>=</c-> <c- mi>1</c->
<c- p>}</c->
</pre>
   <p><img alt="JCTC10" height="575" src="./tests/jctc10.png" width="864"></p>
   <p>Forbidden, cycle in <span class="rel sdep">sdep</span> ∪ <span class="rel rf">rf</span>. No values from thin air.</p>
   <h3 class="heading settled" data-level="4.11" id="jctc11"><span class="secno">4.11. </span><span class="content">JCTC11</span><a class="self-link" href="#jctc11"></a></h3>
<pre class="language-c++ highlight"><c- c1>// Init:</c->
<c- nl>w</c-> <c- p>:</c-><c- o>=</c-> <c- mi>0</c-><c- p>;</c->
<c- nl>x</c-> <c- p>:</c-><c- o>=</c-> <c- mi>0</c-><c- p>;</c->
<c- nl>y</c-> <c- p>:</c-><c- o>=</c-> <c- mi>0</c-><c- p>;</c->
<c- nl>z</c-> <c- p>:</c-><c- o>=</c-> <c- mi>0</c-><c- p>;</c->

<c- c1>// Thread 0:</c->
<c- nl>r1</c-> <c- p>:</c-><c- o>=</c-> <c- n>z</c-><c- p>;</c->
<c- nl>w</c-> <c- p>:</c-><c- o>=</c-> <c- n>r1</c-><c- p>;</c->
<c- nl>r2</c-> <c- p>:</c-><c- o>=</c-> <c- n>x</c-><c- p>;</c->
<c- nl>y</c-> <c- p>:</c-><c- o>=</c-> <c- n>r2</c->

<c- c1>// Thread 1:</c->
<c- nl>r4</c-> <c- p>:</c-><c- o>=</c-> <c- n>w</c-><c- p>;</c->
<c- nl>r3</c-> <c- p>:</c-><c- o>=</c-> <c- n>y</c-><c- p>;</c->
<c- nl>z</c-> <c- p>:</c-><c- o>=</c-> <c- n>r3</c-><c- p>;</c->
<c- nl>x</c-> <c- p>:</c-><c- o>=</c-> <c- mi>1</c->
</pre>
   <p><img alt="JCTC11" height="929" src="./tests/jctc11.png" width="433"></p>
   <p>Allowed, no cycle. Observable through compiler and hardare re-ordering.</p>
   <h3 class="heading settled" data-level="4.12" id="jctc12"><span class="secno">4.12. </span><span class="content">JCTC12</span><a class="self-link" href="#jctc12"></a></h3>
<pre class="language-c++ highlight"><c- c1>// Init:</c->
<c- nl>x</c-> <c- p>:</c-><c- o>=</c-> <c- mi>0</c-><c- p>;</c->
<c- nl>y</c-> <c- p>:</c-><c- o>=</c-> <c- mi>0</c-><c- p>;</c->
<c- nl>a0</c-> <c- p>:</c-><c- o>=</c-> <c- mi>1</c-><c- p>;</c->
<c- nl>a1</c-> <c- p>:</c-><c- o>=</c-> <c- mi>2</c-><c- p>;</c->

<c- c1>// Thread 0:</c->
<c- nl>r1</c-> <c- p>:</c-><c- o>=</c-> <c- n>x</c-><c- p>;</c->
<c- k>if</c-><c- p>(</c-><c- n>r1</c-> <c- o>==</c-> <c- mi>0</c-><c- p>)</c-> <c- p>{</c->
  <c- nl>a0</c-> <c- p>:</c-><c- o>=</c-> <c- mi>0</c->
<c- p>}</c->
<c- k>else</c->
<c- p>{</c->
  <c- k>if</c-><c- p>(</c-><c- n>r1</c-> <c- o>==</c-> <c- mi>1</c-><c- p>)</c-> <c- p>{</c->
    <c- nl>a1</c-> <c- p>:</c-><c- o>=</c-> <c- mi>0</c->
  <c- p>}</c->
<c- p>};</c->
<c- nl>r2</c-> <c- p>:</c-><c- o>=</c-> <c- n>a0</c-><c- p>;</c->
<c- nl>y</c-> <c- p>:</c-><c- o>=</c-> <c- n>r2</c->

<c- c1>// Thread 1:</c->
<c- nl>r3</c-> <c- p>:</c-><c- o>=</c-> <c- n>y</c-><c- p>;</c->
<c- nl>x</c-> <c- p>:</c-><c- o>=</c-> <c- n>r3</c->
</pre>
   <p><img alt="JCTC12" height="929" src="./tests/jctc12.png" width="446"></p>
   <p>Forbidden, cycle in <span class="rel sdep">sdep</span> ∪ <span class="rel rf">rf</span>. No values from thin air.</p>
   <h3 class="heading settled" data-level="4.13" id="jctc13"><span class="secno">4.13. </span><span class="content">JCTC13</span><a class="self-link" href="#jctc13"></a></h3>
<pre class="language-c++ highlight"><c- c1>// Init:</c->
<c- nl>x</c-> <c- p>:</c-><c- o>=</c-> <c- mi>0</c-><c- p>;</c->
<c- nl>y</c-> <c- p>:</c-><c- o>=</c-> <c- mi>0</c-><c- p>;</c->

<c- c1>// Thread 0:</c->
<c- nl>r1</c-> <c- p>:</c-><c- o>=</c-> <c- n>x</c-><c- p>;</c->
<c- k>if</c-><c- p>(</c-><c- n>r1</c-> <c- o>==</c-> <c- mi>1</c-><c- p>)</c-> <c- p>{</c->
  <c- nl>y</c-> <c- p>:</c-><c- o>=</c-> <c- mi>1</c->
<c- p>}</c->

<c- c1>// Thread 1:</c->
<c- nl>r2</c-> <c- p>:</c-><c- o>=</c-> <c- n>y</c-><c- p>;</c->
<c- k>if</c-><c- p>(</c-><c- n>r2</c-> <c- o>==</c-> <c- mi>1</c-><c- p>)</c-> <c- p>{</c->
  <c- nl>x</c-> <c- p>:</c-><c- o>=</c-> <c- mi>1</c->
<c- p>}</c->
</pre>
   <p><img alt="JCTC13" height="457" src="./tests/jctc13.png" width="425"></p>
   <p>Forbidden, cycle in <span class="rel sdep">sdep</span> ∪ <span class="rel rf">rf</span>. No values from thin air.</p>
   <h3 class="heading settled" data-level="4.14" id="jctc14"><span class="secno">4.14. </span><span class="content">JCTC14</span><a class="self-link" href="#jctc14"></a></h3>
   <p>We skip this as it involves loops.</p>
   <h3 class="heading settled" data-level="4.15" id="jctc15"><span class="secno">4.15. </span><span class="content">JCTC15</span><a class="self-link" href="#jctc15"></a></h3>
   <p>We skip this as the test probes Java’s weak coherence-order guarantees, and is not relevant to C++.</p>
   <h3 class="heading settled" data-level="4.16" id="jctc16"><span class="secno">4.16. </span><span class="content">JCTC16</span><a class="self-link" href="#jctc16"></a></h3>
   <p>We skip this as the test probes Java’s weak coherence-order guarantees, and is not relevant to C++.</p>
   <h3 class="heading settled" data-level="4.17" id="jctc17"><span class="secno">4.17. </span><span class="content">JCTC17</span><a class="self-link" href="#jctc17"></a></h3>
   <p>We skip this as the test probes Java’s weak coherence-order guarantees, and is not relevant to C++.</p>
   <h3 class="heading settled" data-level="4.18" id="jctc18-again"><span class="secno">4.18. </span><span class="content">JCTC18</span><a class="self-link" href="#jctc18-again"></a></h3>
   <p>See <a href="#jctc18">§ 2.6 Java Causality Test Case 18</a>.</p>
   <h3 class="heading settled" data-level="4.19" id="jctc19"><span class="secno">4.19. </span><span class="content">JCTC19</span><a class="self-link" href="#jctc19"></a></h3>
   <p>We skip this as it probes thread joining, which is out-of-scope for this paper.</p>
   <h3 class="heading settled" data-level="4.20" id="jctc20"><span class="secno">4.20. </span><span class="content">JCTC20</span><a class="self-link" href="#jctc20"></a></h3>
   <p>We skip this as it probes thread joining, which is out-of-scope for this paper.</p>
  </main>
<script>
(function() {
  "use strict";
  var collapseSidebarText = '<span aria-hidden="true">←</span> '
                          + '<span>Collapse Sidebar</span>';
  var expandSidebarText   = '<span aria-hidden="true">→</span> '
                          + '<span>Pop Out Sidebar</span>';
  var tocJumpText         = '<span aria-hidden="true">↑</span> '
                          + '<span>Jump to Table of Contents</span>';

  var sidebarMedia = window.matchMedia('screen and (min-width: 78em)');
  var autoToggle   = function(e){ toggleSidebar(e.matches) };
  if(sidebarMedia.addListener) {
    sidebarMedia.addListener(autoToggle);
  }

  function toggleSidebar(on) {
    if (on == undefined) {
      on = !document.body.classList.contains('toc-sidebar');
    }

    /* Don’t scroll to compensate for the ToC if we’re above it already. */
    var headY = 0;
    var head = document.querySelector('.head');
    if (head) {
      // terrible approx of "top of ToC"
      headY += head.offsetTop + head.offsetHeight;
    }
    var skipScroll = window.scrollY < headY;

    var toggle = document.getElementById('toc-toggle');
    var tocNav = document.getElementById('toc');
    if (on) {
      var tocHeight = tocNav.offsetHeight;
      document.body.classList.add('toc-sidebar');
      document.body.classList.remove('toc-inline');
      toggle.innerHTML = collapseSidebarText;
      if (!skipScroll) {
        window.scrollBy(0, 0 - tocHeight);
      }
      tocNav.focus();
      sidebarMedia.addListener(autoToggle); // auto-collapse when out of room
    }
    else {
      document.body.classList.add('toc-inline');
      document.body.classList.remove('toc-sidebar');
      toggle.innerHTML = expandSidebarText;
      if (!skipScroll) {
        window.scrollBy(0, tocNav.offsetHeight);
      }
      if (toggle.matches(':hover')) {
        /* Unfocus button when not using keyboard navigation,
           because I don’t know where else to send the focus. */
        toggle.blur();
      }
    }
  }

  function createSidebarToggle() {
    /* Create the sidebar toggle in JS; it shouldn’t exist when JS is off. */
    var toggle = document.createElement('a');
      /* This should probably be a button, but appearance isn’t standards-track.*/
    toggle.id = 'toc-toggle';
    toggle.class = 'toc-toggle';
    toggle.href = '#toc';
    toggle.innerHTML = collapseSidebarText;

    sidebarMedia.addListener(autoToggle);
    var toggler = function(e) {
      e.preventDefault();
      sidebarMedia.removeListener(autoToggle); // persist explicit off states
      toggleSidebar();
      return false;
    }
    toggle.addEventListener('click', toggler, false);


    /* Get <nav id=toc-nav>, or make it if we don’t have one. */
    var tocNav = document.getElementById('toc-nav');
    if (!tocNav) {
      tocNav = document.createElement('p');
      tocNav.id = 'toc-nav';
      /* Prepend for better keyboard navigation */
      document.body.insertBefore(tocNav, document.body.firstChild);
    }
    /* While we’re at it, make sure we have a Jump to Toc link. */
    var tocJump = document.getElementById('toc-jump');
    if (!tocJump) {
      tocJump = document.createElement('a');
      tocJump.id = 'toc-jump';
      tocJump.href = '#toc';
      tocJump.innerHTML = tocJumpText;
      tocNav.appendChild(tocJump);
    }

    tocNav.appendChild(toggle);
  }

  var toc = document.getElementById('toc');
  if (toc) {
    createSidebarToggle();
    toggleSidebar(sidebarMedia.matches);

    /* If the sidebar has been manually opened and is currently overlaying the text
       (window too small for the MQ to add the margin to body),
       then auto-close the sidebar once you click on something in there. */
    toc.addEventListener('click', function(e) {
      if(e.target.tagName.toLowerCase() == "a" && document.body.classList.contains('toc-sidebar') && !sidebarMedia.matches) {
        toggleSidebar(false);
      }
    }, false);
  }
  else {
    console.warn("Can’t find Table of Contents. Please use <nav id='toc'> around the ToC.");
  }

  /* Wrap tables in case they overflow */
  var tables = document.querySelectorAll(':not(.overlarge) > table.data, :not(.overlarge) > table.index');
  var numTables = tables.length;
  for (var i = 0; i < numTables; i++) {
    var table = tables[i];
    var wrapper = document.createElement('div');
    wrapper.className = 'overlarge';
    table.parentNode.insertBefore(wrapper, table);
    wrapper.appendChild(table);
  }

})();
</script>
  <h2 class="no-num no-ref heading settled" id="references"><span class="content">References</span><a class="self-link" href="#references"></a></h2>
  <h3 class="no-num no-ref heading settled" id="informative"><span class="content">Informative References</span><a class="self-link" href="#informative"></a></h3>
  <dl>
   <dt id="biblio-jct">[JCT]
   <dd>William Pugh. <a href="https://www.cs.umd.edu/~pugh/java/memoryModel/CausalityTestCases.html"><cite>Causality Test Cases</cite></a>. URL: <a href="https://www.cs.umd.edu/~pugh/java/memoryModel/CausalityTestCases.html">https://www.cs.umd.edu/~pugh/java/memoryModel/CausalityTestCases.html</a>
   <dt id="biblio-p1217r1">[P1217R1]
   <dd>Hans-J. Boehm. <a href="https://wg21.link/p1217r1"><cite>Out-of-thin-air, revisited, again</cite></a>. 10 March 2019. URL: <a href="https://wg21.link/p1217r1">https://wg21.link/p1217r1</a>
   <dt id="biblio-p1780">[P1780]
   <dd>Mark Batty; et al. <a href="https://graymalk.in/iso-papers/p1780/p1780r2.html"><cite>Modular Relaxed Dependencies: A new approach to the Out-Of-Thin-Air Problem</cite></a>. URL: <a href="https://graymalk.in/iso-papers/p1780/p1780r2.html">https://graymalk.in/iso-papers/p1780/p1780r2.html</a>
   <dt id="biblio-problem">[Problem]
   <dd>Mark Batty; et al. <a href="https://link.springer.com/chapter/10.1007/978-3-662-46669-8_12"><cite>The Problem of Programming Language Concurrency Semantics</cite></a>. URL: <a href="https://link.springer.com/chapter/10.1007/978-3-662-46669-8_12">https://link.springer.com/chapter/10.1007/978-3-662-46669-8_12</a>
   <dt id="biblio-pwt">[PwT]
   <dd>James Riely; et al. <a href="https://dl.acm.org/doi/10.1145/3498716"><cite>The leaky semicolon: compositional semantic dependencies for relaxed-memory concurrency</cite></a>. URL: <a href="https://dl.acm.org/doi/10.1145/3498716">https://dl.acm.org/doi/10.1145/3498716</a>
   <dt id="biblio-sevcik">[Sevcik]
   <dd>Jaroslav Ševčík. <a href="https://era.ed.ac.uk/handle/1842/3132"><cite>Program Transformations in Weak Memory Models</cite></a>. URL: <a href="https://era.ed.ac.uk/handle/1842/3132">https://era.ed.ac.uk/handle/1842/3132</a>
   <dt id="biblio-weakestmo">[WeakestMO]
   <dd>Soham Chakraborty; Viktor Vafeiadis. <a href="https://dl.acm.org/doi/abs/10.1145/3290383"><cite>Grounding thin-air reads with event structures</cite></a>. URL: <a href="https://dl.acm.org/doi/abs/10.1145/3290383">https://dl.acm.org/doi/abs/10.1145/3290383</a>
  </dl>